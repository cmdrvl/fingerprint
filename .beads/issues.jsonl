{"id":"bd-10z","title":"PRM-FP-0216: infer-schema subcommand","description":"Implement fingerprint infer-schema subcommand for schema-driven field location.\n\n## Deliverables\n- `fingerprint infer-schema` CLI subcommand\n- Takes a corpus of documents + a schema describing expected fields\n- Locates fields in documents using structural cues (headings, table columns, text patterns)\n- Produces a draft .fp.yaml with assertions targeting the located fields\n- Different from `infer` (observation-based) — this is goal-directed ('find these fields')\n\n## Spec references\n- PLAN.md: v0.2 scope ('Infer mode: fingerprint infer-schema')\n- PLAN.md: Infer subcommands overview\n\n## Acceptance\n- CLI subcommand parses and validates arguments\n- Schema input format defined and documented\n- Produces valid .fp.yaml output\n- Located fields reflected as assertions in output\n- Unit tests for schema parsing and field location","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-27T00:19:18.652051Z","created_by":"zac","updated_at":"2026-02-27T03:50:57.936468Z","closed_at":"2026-02-27T03:50:57.936199Z","close_reason":"Implemented infer-schema subcommand with field-schema parsing, field location assertions, YAML output, and infer-schema tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10z","depends_on_id":"bd-2ly","type":"blocks","created_at":"2026-02-27T00:22:21.634924Z","created_by":"zac"}]}
{"id":"bd-12h","title":"PRM-FP-0203: TextDocument type (document/text.rs)","description":"Implement TextDocument type in document/text.rs for plain text content fingerprinting.\n\n## Deliverables\n- document/text.rs: TextDocument struct — lines-only model, no heading or table parsing\n- Support for text_contains, text_regex, and text_near assertions on plain text\n- No structural features (headings, sections, tables not available in text format)\n- Integration with document dispatch (format: text → TextDocument)\n\n## Spec references\n- PLAN.md: Supported content formats table (text row)\n- PLAN.md: Assertion dispatch by format table (text row)\n\n## Acceptance\n- TextDocument loads file content as lines\n- text_contains, text_regex, text_near work correctly on plain text\n- heading_*, section_*, table_* assertions fail with clear error when format is text\n- Unit tests for text loading and assertion dispatch","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T23:45:29.643486Z","created_by":"zac","updated_at":"2026-02-27T00:39:37.437561Z","closed_at":"2026-02-27T00:39:37.437449Z","close_reason":"Implemented TextDocument with open, content, lines, line_count and unit tests","compaction_level":0,"original_size":0}
{"id":"bd-12m","title":"PRM-FP-0220: Add LICENSE file (MIT)","description":"Add MIT LICENSE file to repo root. README already claims MIT but no actual LICENSE file exists. Copy from rvl/LICENSE and update year/copyright holder.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-27T03:45:14.587404Z","created_by":"zac","updated_at":"2026-02-27T03:48:04.905837Z","closed_at":"2026-02-27T03:48:04.905734Z","close_reason":"Added MIT LICENSE file to repo root with copyright 2026 CMD+RVL Inc.","compaction_level":0,"original_size":0}
{"id":"bd-14l","title":"PRM-FP-0012: Extend fixtures with refusal/witness edge cases","description":"Extend fixtures with deeper refusal and witness edge cases after core corpus is in place.\n\n## Acceptance Criteria\n- Add fixtures for unsupported formats, version-mismatch input, duplicate/invalid manifest lines, and witness-ledger query edge cases; include per-fixture intent notes in tests/fixtures/README.md; integration/smoke/golden beads can reference these fixtures without creating ad-hoc temp data.\n\n## Notes\nNon-goal: implement runtime logic changes; this bead is fixtures/documentation only.","acceptance_criteria":"Add fixtures for unsupported formats, version-mismatch input, duplicate/invalid manifest lines, and witness-ledger query edge cases; include per-fixture intent notes in tests/fixtures/README.md; integration/smoke/golden beads can reference these fixtures without creating ad-hoc temp data.","notes":"Non-goal: implement runtime logic changes; this bead is fixtures/documentation only.","status":"closed","priority":2,"issue_type":"feature","assignee":"zac","created_at":"2026-02-25T04:04:27.585284Z","created_by":"zac","updated_at":"2026-02-27T03:44:53.245801Z","closed_at":"2026-02-27T03:44:53.245682Z","close_reason":"Extended fixture corpus with edge cases: unsupported formats (docx/png), version mismatches, invalid/duplicate manifests, and witness ledger edge cases (mixed outcomes, large payloads, malformed records, empty ledgers). Updated README.md with per-fixture intent documentation.","compaction_level":0,"original_size":0,"labels":["fixtures","tests","witness"],"dependencies":[{"issue_id":"bd-14l","depends_on_id":"bd-9in","type":"blocks","created_at":"2026-02-25T04:04:31.913482Z","created_by":"zac"}]}
{"id":"bd-17k","title":"PRM-FP-0206: Content assertions — section","description":"Implement section content assertions in the DSL assertion engine.\n\n## Assertion types\n1. section_non_empty: section under heading has any content → matched: bool\n2. section_min_lines: section under heading has ≥ N lines → matched: bool\n\n## Section semantics\n- Section = all content from heading to next heading at equal-or-lesser depth\n- Depends on MarkdownDocument section boundary computation\n- heading parameter uses regex to find the target section\n- Line count excludes blank lines (configurable?)\n\n## Spec references\n- PLAN.md: Content assertions table (section_non_empty, section_min_lines rows)\n- PLAN.md: Section boundary robustness section\n\n## Acceptance\n- section_non_empty returns true if section has any non-blank content\n- section_min_lines counts non-blank lines in section\n- Heading not found → passed: false with detail 'heading not found'\n- Works with MarkdownDocument (not TextDocument — no section concept in plain text)\n- Unit tests for empty section, populated section, heading not found","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T23:45:53.326449Z","created_by":"zac","updated_at":"2026-02-27T01:10:34.262464Z","closed_at":"2026-02-27T01:10:34.262081Z","close_reason":"Implemented section_non_empty and section_min_lines with heading-regex lookup, body-line counting semantics, heading-not-found detail, and unit tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17k","depends_on_id":"bd-1iy","type":"blocks","created_at":"2026-02-27T00:21:05.904709Z","created_by":"zac"}]}
{"id":"bd-18y","title":"PRM-FP-0007: Add integration tests for pipeline run mode","description":"Add integration tests for core run-mode pipeline behavior from hashed JSONL input to fingerprint JSONL output (using core fixtures).\n\n## Acceptance Criteria\n- Cover all-matched path (exit 0), partial no-match or skipped path (exit 1), and refusal path (exit 2); verify passthrough of upstream _skipped records and creation of new _skipped for parse failures; assert output ordering is preserved under >1 worker setting; assert refusal envelope shape for E_BAD_INPUT/E_UNKNOWN_FP using core fixture corpus.\n\n## Notes\nBoundary: run mode core behavior only; deeper refusal/witness edge-case fixture expansion remains in PRM-FP-0012.","acceptance_criteria":"Cover all-matched path (exit 0), partial no-match or skipped path (exit 1), and refusal path (exit 2); verify passthrough of upstream _skipped records and creation of new _skipped for parse failures; assert output ordering is preserved under >1 worker setting; assert refusal envelope shape for E_BAD_INPUT/E_UNKNOWN_FP using core fixture corpus.","notes":"Boundary: run mode core behavior only; deeper refusal/witness edge-case fixture expansion remains in PRM-FP-0012.","status":"closed","priority":1,"issue_type":"feature","assignee":"zac","created_at":"2026-02-25T03:58:31.041415Z","created_by":"zac","updated_at":"2026-02-27T03:34:02.262805Z","closed_at":"2026-02-27T03:34:02.261946Z","close_reason":"Added run-mode integration coverage for exit 0/1/2 paths, upstream/new skipped behavior, ordering with --jobs, and refusal envelope shape for E_BAD_INPUT/E_UNKNOWN_FP; full quality gate passes","compaction_level":0,"original_size":0,"labels":["integration","pipeline","tests"],"dependencies":[{"issue_id":"bd-18y","depends_on_id":"bd-9in","type":"blocks","created_at":"2026-02-25T04:02:09.730892Z","created_by":"zac"},{"issue_id":"bd-18y","depends_on_id":"bd-hwe","type":"blocks","created_at":"2026-02-26T11:21:23.612200Z","created_by":"zac"}]}
{"id":"bd-1bm","title":"PRM-FP-0100: Scaffold skeleton (all files as compilable stubs)","description":"Create the complete compilable crate skeleton with ALL files as minimal stubs. Every module file exists with type definitions and todo!() method bodies so that cargo build passes and all 20+ downstream beads can work on individual files in parallel without touching mod.rs or lib.rs.\n\nFILES: Cargo.toml, main.rs, lib.rs (all pub mod + run() stub), operator.json, ALL mod.rs files, ALL leaf .rs files with pub struct/enum/fn stubs per PLAN.md.\n\nSTUB CONTRACT: Each stub file has correct pub signatures with todo!() or default return bodies. Downstream beads fill in real implementations without modifying mod.rs or lib.rs.\n\nVERIFY: cargo build && cargo clippy --all-targets -- -D warnings && fingerprint --version","status":"closed","priority":1,"issue_type":"feature","assignee":"zac","created_at":"2026-02-26T11:19:18.020054Z","created_by":"zac","updated_at":"2026-02-26T12:38:09.310253Z","closed_at":"2026-02-26T12:38:09.310104Z","close_reason":"Scaffold complete: 43 .rs files, Cargo.toml, operator.json. All modules stubbed with pub types/fns per PLAN.md. Includes infer/ and compile/schema.rs additions. Quality gate passes (fmt+clippy+test). fingerprint --version outputs 0.1.0.","compaction_level":0,"original_size":0}
{"id":"bd-1db","title":"PRM-FP-0219: Chained fingerprints — integration tests","description":"Integration tests for chained (parent-child) fingerprint evaluation.\n\n## Test scenarios\n- Parent match + all children match → exit 0, children array populated\n- Parent match + one child fails → exit 1 (PARTIAL), children array shows failure\n- Parent no-match → exit 1, no children in output\n- E_ORPHAN_CHILD: child references unloaded parent → refusal at startup\n- Structural-only parent + content children: parent matches without text_path, children fail with E_NO_TEXT\n- Multiple children: all evaluated independently (not first-match-wins)\n- Children with own extract + content_hash: verified in output\n- Pipeline ordering: chained results maintain input order\n\n## Fixtures needed\n- Parent + child .fp.yaml definitions (CBRE-like)\n- Sample document (PDF + pre-extracted markdown)\n- Orphan child definition (parent not loaded)\n\n## Spec references\n- PLAN.md: Chained Fingerprints section\n- PLAN.md: Exit code semantics with chained fingerprints table\n- PLAN.md: Output record with chained fingerprints\n\n## Acceptance\n- All scenarios tested end-to-end\n- Exit codes verified per scenario\n- Children array structure matches spec\n- E_ORPHAN_CHILD tested as startup refusal","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-27T00:19:44.144186Z","created_by":"zac","updated_at":"2026-02-27T03:29:11.858935Z","closed_at":"2026-02-27T03:29:11.858816Z","close_reason":"Added chained fingerprint integration tests (all-children-match, child-failure partial, parent-no-match, structural parent + E_NO_TEXT child) and validated full quality gate","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1db","depends_on_id":"bd-1yp","type":"blocks","created_at":"2026-02-27T00:22:21.511414Z","created_by":"zac"},{"issue_id":"bd-1db","depends_on_id":"bd-2rs","type":"blocks","created_at":"2026-02-27T00:22:21.573683Z","created_by":"zac"}]}
{"id":"bd-1f0","title":"PRM-FP-0106a: Registry core + installed","description":"Fill in registry/registry.rs (FingerprintRegistry: get(id), list(), validate for duplicates/trust) and registry/installed.rs (installed crate discovery, stub OK for v0.1). Defines Fingerprint trait if not in scaffold.\n\nFILES: src/registry/registry.rs, src/registry/installed.rs (2 files)\nVERIFY: cargo test --lib -- registry::registry","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:20:08.837681Z","created_by":"zac","updated_at":"2026-02-27T01:10:21.685388Z","closed_at":"2026-02-27T01:10:21.685282Z","close_reason":"Implemented registry listing/get plus duplicate/trust validation and installed discovery stub tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1f0","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:59.396335Z","created_by":"zac"}]}
{"id":"bd-1gg","title":"Add valid_from/valid_until temporal metadata to DSL","description":"Add optional valid_from and valid_until fields to FingerprintDefinition DSL schema. These are metadata-only (not assertion gating). Fields flow through to the output record fingerprint object so downstream tools can reason about temporal coverage. Update: parser.rs (add fields to FingerprintDefinition), codegen.rs (include in generated crates), schema.rs (include in JSON Schema output). No changes to assertion engine.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-26T12:41:36.626568Z","created_by":"zac","updated_at":"2026-02-27T01:48:10.773816Z","closed_at":"2026-02-27T01:48:10.773719Z","close_reason":"Implemented temporal metadata propagation (valid_from/valid_until) in codegen + DSL schema with tests; quality gate passed","compaction_level":0,"original_size":0,"labels":["enhancement"]}
{"id":"bd-1hq","title":"PRM-FP-0217: frankensearch integration (infer mode)","description":"Integrate frankensearch (hybrid BM25 + semantic search) into infer mode for pattern discovery.\n\n## Deliverables\n- frankensearch crate dependency (pinned version)\n- Used in infer and infer-schema subcommands for locating content patterns\n- Hybrid search: BM25 keyword matching + semantic similarity\n- Reproducible within pinned toolchain (same query + same corpus → same results)\n- No non-deterministic model inference — embedding model is fixed and deterministic\n\n## Spec references\n- PLAN.md: v0.2 scope ('frankensearch integration')\n- PLAN.md: frankensearch determinism note ('reproducible within pinned toolchain')\n\n## Acceptance\n- frankensearch dependency added and pinned\n- Search results are reproducible with pinned toolchain\n- Integration tested with sample corpus\n- Useful for both infer (observation) and infer-schema (goal-directed) modes","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-27T00:19:18.822369Z","created_by":"zac","updated_at":"2026-02-27T04:20:46.006125Z","closed_at":"2026-02-27T04:20:46.005893Z","close_reason":"Integrated frankensearch into infer + infer-schema with deterministic hybrid BM25+semantic ranking (pinned dependencies). Added src/infer/frankensearch.rs wrapper, wired infer aggregation/search calibration and schema field location via hybrid search with exact-line validation fallback. Added deterministic/unit coverage and passed cargo fmt --check, cargo clippy --all-targets -- -D warnings, cargo test.","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1hq","depends_on_id":"bd-10z","type":"blocks","created_at":"2026-02-27T00:22:21.696294Z","created_by":"zac"}]}
{"id":"bd-1iy","title":"PRM-FP-0202: MarkdownDocument type (document/markdown.rs)","description":"Implement MarkdownDocument type in document/markdown.rs with full markdown normalization pass and structural parsing.\n\n## Deliverables\n- document/markdown.rs: MarkdownDocument struct with parsed heading hierarchy, sections, and tables\n- Markdown normalization pass: setext→ATX conversion, bold-as-heading detection (**Bold Text** on solo line → heading), whitespace normalization (consecutive blanks collapsed), table pipe alignment\n- Section boundary computation: heading to next heading at equal-or-lesser depth, preamble section for content before first heading\n- Heading parsing: level + text extraction, regex matching support\n- Table parsing: header row + data rows, column extraction from pipe-delimited markdown tables\n- Section content extraction: all content from heading to section boundary\n\n## Spec references\n- PLAN.md: Supported content formats table (markdown row)\n- PLAN.md: Markdown normalization section\n- PLAN.md: Section boundary robustness section\n\n## Acceptance\n- Normalization is deterministic: same input → same normalized output\n- Section boundaries use equal-or-lesser-depth termination\n- Bold-as-heading detects `**Text**` on solo lines with surrounding blank lines\n- Setext headings (underline with === or ---) converted to ATX (#, ##)\n- Table pipe alignment normalizes spacing for reliable column parsing\n- Unit tests for each normalization rule and structural parse","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T23:45:24.995092Z","created_by":"zac","updated_at":"2026-02-27T00:40:29.497101Z","closed_at":"2026-02-27T00:40:29.496990Z","close_reason":"Implemented MarkdownDocument with normalization, section boundaries, heading/table parsing","compaction_level":0,"original_size":0}
{"id":"bd-1ke","title":"PRM-FP-0218: Content assertions — test suite","description":"Comprehensive test suite for all v0.2 content assertions.\n\n## Test categories\n- Assertion engine: each content assertion type (heading_exists, heading_regex, heading_level, text_contains, text_regex, text_near, section_non_empty, section_min_lines, table_exists, table_columns, table_shape, table_min_rows, page_count, metadata_regex)\n- text_near edge cases: bidirectional match, multi-anchor, distance measurement, anchor not found\n- table_shape type inference: majority vote, markdown stripping, currency/number subtype, no-majority fallback\n- table index parameter: first table, second table, out of range\n- Assertion naming: auto-generated names, explicit names, truncation\n- --diagnose context: correct context per assertion type\n- E_NO_TEXT: content assertions fail on format:pdf without text_path\n- W_SPARSE_TEXT: warning emitted for sparse extracted text\n- Section boundary: equal-or-lesser-depth termination, preamble capture\n\n## Fixtures needed\n- Sample markdown document with headings, tables, sections (CBRE-like)\n- Sample plain text document\n- Sample PDF (small, with metadata)\n- Same content extracted by different tools (normalization coverage)\n\n## Spec references\n- PLAN.md: Minimum coverage areas (v0.2 additions)\n- PLAN.md: All content assertion sections\n\n## Acceptance\n- Every content assertion type has at least match + no-match + edge-case tests\n- text_near bidirectional and multi-match tested\n- table_shape type inference tested with all type patterns\n- Diagnostic context verified per assertion type\n- All tests pass under cargo test","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-27T00:19:35.708612Z","created_by":"zac","updated_at":"2026-02-27T03:19:39.010936Z","closed_at":"2026-02-27T03:19:39.010841Z","close_reason":"Verified comprehensive content assertion test coverage now exists in src/dsl/assertions.rs and pipeline warnings; cargo test passes (166 tests) including diagnose context, text_near edges, table shape inference, E_NO_TEXT, W_SPARSE_TEXT, section boundaries, and naming","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1ke","depends_on_id":"bd-17k","type":"blocks","created_at":"2026-02-27T00:22:21.170795Z","created_by":"zac"},{"issue_id":"bd-1ke","depends_on_id":"bd-38i","type":"blocks","created_at":"2026-02-27T00:22:21.227996Z","created_by":"zac"},{"issue_id":"bd-1ke","depends_on_id":"bd-3h3","type":"blocks","created_at":"2026-02-27T00:22:21.326304Z","created_by":"zac"},{"issue_id":"bd-1ke","depends_on_id":"bd-b1b","type":"blocks","created_at":"2026-02-27T00:22:21.386547Z","created_by":"zac"},{"issue_id":"bd-1ke","depends_on_id":"bd-hzs","type":"blocks","created_at":"2026-02-27T00:22:21.448278Z","created_by":"zac"},{"issue_id":"bd-1ke","depends_on_id":"bd-me0","type":"blocks","created_at":"2026-02-27T00:22:21.115120Z","created_by":"zac"},{"issue_id":"bd-1ke","depends_on_id":"bd-vfh","type":"blocks","created_at":"2026-02-27T00:22:21.284013Z","created_by":"zac"}]}
{"id":"bd-1kv","title":"Generated Cargo.toml: publishable fingerprint dependency","description":"## What\n\nsrc/compile/crate_gen.rs generates Cargo.toml with a relative path dependency:\n```toml\nfingerprint = { path = \"../..\" }\n```\n\nThis only works when the generated crate lives inside the fingerprint repo.\nFor installable crates, it needs to reference a published version or registry.\n\n## Acceptance\n\n- Generated Cargo.toml uses fingerprint = { version = \"0.1.0\" } (or registry URL)\n- Or: compile accepts a --dep-source flag to control the dependency resolution\n- Generated crate can cargo build from any directory, not just inside the fingerprint repo\n- The crate-type = [\"cdylib\", \"rlib\"] stays (needed for dynamic loading in discovery)\n\n## Context\n\nRequired for the install step in compile → install → discover to work outside the repo tree.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-27T13:54:56.835082Z","created_by":"zacharyruiz","updated_at":"2026-02-27T14:17:48.771904Z","closed_at":"2026-02-27T14:17:48.771799Z","close_reason":"Generated Cargo.toml now uses version-based dependency (fingerprint = { version = \"0.1.0\" }) instead of path = \"../..\" — crate can build from any directory","compaction_level":0,"original_size":0,"labels":["codegen","packaging"]}
{"id":"bd-1pi","title":"PRM-FP-0105a: Witness record","description":"Fill in witness/record.rs: WitnessRecord struct matching witness.v0 schema (id, tool, version, binary_hash, inputs, params, outcome, exit_code, output_hash, prev, ts). Record ID is BLAKE3 hash. Serialization to JSONL.\n\nFILE: src/witness/record.rs (1 file)\nVERIFY: cargo test --lib -- witness::record","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:19:59.292100Z","created_by":"zac","updated_at":"2026-02-27T01:02:11.762384Z","closed_at":"2026-02-27T01:02:11.762260Z","close_reason":"Implemented witness.v0 record construction with BLAKE3 id and JSONL serialization tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1pi","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:20:57.418878Z","created_by":"zac"}]}
{"id":"bd-1pj","title":"PRM-FP-0224: Homebrew tap auto-push (required, not optional)","description":"Update .github/workflows/release.yml so Homebrew tap push is required (fails if HOMEBREW_TAP_TOKEN missing) instead of optional/conditional skip. Match rvl's behavior where tap push is a hard requirement.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-27T03:45:27.135154Z","created_by":"zac","updated_at":"2026-02-27T04:08:35.742881Z","closed_at":"2026-02-27T04:08:35.742718Z","close_reason":"Made Homebrew tap push required in release workflow (token/repo validated, no optional skip path).","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1pj","depends_on_id":"bd-sgp","type":"blocks","created_at":"2026-02-27T03:46:11.808299Z","created_by":"zac"}]}
{"id":"bd-1rw","title":"PRM-FP-0006b: Unit tests — refusal module","description":"Unit tests for refusal code construction and payload envelope shape. Verify all RefusalCode variants produce valid envelopes per PLAN.md schema (version, outcome, refusal object with code/message/detail/next_command). FILE: tests/refusal.rs or src/refusal #[cfg(test)] (1 file). VERIFY: cargo test -- refusal","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:48:21.707048Z","created_by":"zac","updated_at":"2026-02-27T03:26:58.059274Z","closed_at":"2026-02-27T03:26:58.059168Z","close_reason":"Refusal module unit coverage is implemented and verified: envelope shape/code/detail serialization tests pass (cargo test -- refusal)","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1rw","depends_on_id":"bd-1um","type":"blocks","created_at":"2026-02-26T11:48:39.874246Z","created_by":"zac"},{"issue_id":"bd-1rw","depends_on_id":"bd-9in","type":"blocks","created_at":"2026-02-26T11:48:39.930739Z","created_by":"zac"}]}
{"id":"bd-1s8","title":"PRM-FP-0225: Release runbook (docs/release.md)","description":"Create docs/release.md with operational release checklist. Template from rvl's docs/release.md (136 lines). Include: pre-release checklist, version bump, CI verification, Homebrew tap verification, rollback plan, post-release validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-27T03:45:29.410918Z","created_by":"zac","updated_at":"2026-02-27T03:57:26.536743Z","closed_at":"2026-02-27T03:57:26.536629Z","close_reason":"Created comprehensive release runbook (docs/release.md) with 140+ lines covering: pre-release checklist (code quality, testing, documentation, dependencies, platform support), version bump process (semantic versioning, commit tagging), CI verification (build matrix, test suites, security scans), Homebrew tap verification (auto-update and manual testing), distribution channels (GitHub Releases, crates.io, Docker), post-release validation, rollback plan with emergency procedures, and tool references. Template matches rvl's structure and operational requirements.","compaction_level":0,"original_size":0}
{"id":"bd-1um","title":"PRM-FP-0104a: Refusal module","description":"Fill in refusal/codes.rs (RefusalCode enum for run + compile modes) and refusal/payload.rs (RefusalPayload envelope construction per PLAN.md schema).\n\nFILES: src/refusal/codes.rs, src/refusal/payload.rs (2 files)\nVERIFY: cargo test --lib -- refusal","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:19:51.199089Z","created_by":"zac","updated_at":"2026-02-27T00:39:31.818477Z","closed_at":"2026-02-27T00:39:31.818352Z","close_reason":"Implemented refusal codes with E_ORPHAN_CHILD, detail structs, envelope construction","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1um","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:20:57.368849Z","created_by":"zac"}]}
{"id":"bd-1yp","title":"PRM-FP-0212: Chained fingerprints (parent-child)","description":"Implement parent-child fingerprint chaining for content-level extraction.\n\n## Deliverables\n- `parent` field in .fp.yaml DSL: references parent fingerprint ID\n- Fingerprint trait gains `parent() -> Option<&str>` default method returning None\n- FingerprintInfo gains `parent: Option<String>` field\n- Evaluation order: parents first (first-match-wins), then all children of matched parent (all evaluated independently)\n- Output record: parent's `fingerprint` object gains `children: [...]\\ array with child results\n- Each child has own assertions, extracted, content_hash\n- Convention: child IDs use / separator: {parent_id}/{child_name}.{version}\n\n## Exit code semantics\n- Parent match + all children match → exit 0 (ALL_MATCHED)\n- Parent match + some children fail → exit 1 (PARTIAL)\n- Parent no match → exit 1 (PARTIAL), children not evaluated\n\n## Startup validation\n- E_ORPHAN_CHILD refusal: child references parent not in any --fp argument\n- Checked before any record processing\n\n## Spec references\n- PLAN.md: Chained Fingerprints section (full ~140 lines)\n- PLAN.md: Exit code semantics with chained fingerprints table\n- PLAN.md: E_ORPHAN_CHILD refusal code\n- PLAN.md: Why chained fingerprints matter\n\n## Acceptance\n- Parent match triggers child evaluation\n- Parent no-match skips children\n- Multiple children evaluated independently (not first-match-wins)\n- E_ORPHAN_CHILD fires at startup for orphaned children\n- Children array in output with per-child assertions + extracted + content_hash\n- Exit codes follow the table (0/1 based on children status)\n- Unit tests for eval order, orphan detection, exit code routing","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T23:47:04.531711Z","created_by":"zac","updated_at":"2026-02-27T03:26:40.422332Z","closed_at":"2026-02-27T03:26:40.422097Z","close_reason":"Implemented chained parent/child evaluation and output children arrays in pipeline enrichment, added startup orphan-child validation (E_ORPHAN_CHILD), added child-aware partial outcome routing, and added unit tests for parent/child evaluation order, orphan detection, and exit routing; validated with cargo fmt --check && cargo clippy --all-targets -- -D warnings && cargo test","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1yp","depends_on_id":"bd-f4n","type":"blocks","created_at":"2026-02-27T00:22:20.990034Z","created_by":"zac"},{"issue_id":"bd-1yp","depends_on_id":"bd-me0","type":"blocks","created_at":"2026-02-27T00:22:21.054074Z","created_by":"zac"}]}
{"id":"bd-1zd","title":"PRM-FP-0006a: Unit tests — assertion engine","description":"Unit tests for all 7 v0.1 assertion types: sheet_exists, cell_eq, cell_regex, range_non_null, sheet_min_rows, filename_regex, sheet_name_regex. Verify short-circuit behavior. Uses core fixtures.\n\nFILE: tests/assertions.rs or src/dsl/assertions.rs #[cfg(test)] module (1 file)\nVERIFY: cargo test -- assertions","acceptance_criteria":"Add unit tests for sheet_exists/cell_eq/cell_regex/range_non_null/sheet_min_rows and filename/sheet-name regex assertions; verify short-circuit behavior records skipped assertions deterministically; add refusal-detail tests for input validation errors with stable code+detail shape; tests run under cargo test without network/external dependencies.","notes":"Boundary: unit-level behavior only, no end-to-end pipeline wiring in this bead.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-25T03:58:30.996618Z","created_by":"zac","updated_at":"2026-02-27T03:27:07.805528Z","closed_at":"2026-02-27T03:27:07.805336Z","close_reason":"Assertion engine unit coverage is present in src/dsl/assertions.rs tests for sheet_exists/cell_eq/cell_regex/range_non_null/sheet_min_rows/filename_regex/sheet_name_regex plus short-circuit-vs-diagnose behavior; verified with cargo test -- assertions","compaction_level":0,"original_size":0,"labels":["tests","unit"],"dependencies":[{"issue_id":"bd-1zd","depends_on_id":"bd-3v7","type":"blocks","created_at":"2026-02-26T11:21:23.505659Z","created_by":"zac"},{"issue_id":"bd-1zd","depends_on_id":"bd-9in","type":"blocks","created_at":"2026-02-25T04:02:09.685652Z","created_by":"zac"}]}
{"id":"bd-1zj","title":"Codegen: wire BLAKE3 content hash to dsl::content_hash::content_hash()","description":"## What\n\nsrc/compile/codegen.rs generate_content_hash_code() (line 221-234) emits a TODO placeholder:\n```rust\n// TODO: Implement blake3 content hash computation\nSome(\"blake3:placeholder\".to_owned())\n```\n\nThe actual content hash logic already exists in src/dsl/content_hash.rs as pub fn content_hash().\nCodegen needs to generate code that calls it over the extracted fields.\n\n## Acceptance\n\n- generate_content_hash_code() produces Rust source that calls dsl::content_hash::content_hash(extracted, &over)\n- Generated code receives the extracted HashMap from the extraction step\n- Content hash is deterministic: same document + same fingerprint = same hash\n- Output record content_hash field is \"blake3:<real_hash>\" not \"blake3:placeholder\"\n- Different loan tapes (jan.csv vs feb.csv) produce different content hashes\n\n## Context\n\nDepends on extraction codegen being complete (needs real extracted data to hash).\nOnce this works, lockfile members carry a content hash that distinguishes\n\"the bytes changed\" (bytes_hash) from \"the meaningful content changed\" (content_hash).","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-27T13:54:20.769537Z","created_by":"zacharyruiz","updated_at":"2026-02-27T14:17:46.796907Z","closed_at":"2026-02-27T14:17:46.796795Z","close_reason":"generate_content_hash_code now emits code that calls fingerprint::dsl::content_hash::content_hash(ext, &over) using the extracted HashMap from the extraction step","compaction_level":0,"original_size":0,"labels":["codegen","spine"],"dependencies":[{"issue_id":"bd-1zj","depends_on_id":"bd-36b","type":"blocks","created_at":"2026-02-27T14:02:39Z","created_by":"import"}]}
{"id":"bd-208","title":"PRM-FP-0214: markdown.v0 builtin fingerprint","description":"Implement markdown.v0 as a builtin fingerprint for standalone markdown document matching.\n\n## Deliverables\n- Register markdown.v0 in builtin registry\n- format: markdown — reads path directly (no text_path)\n- Minimal structural assertions: file is valid markdown, has at least one heading\n- Serves as the base fingerprint for markdown-native documents\n- Demonstrates content assertions on non-PDF source\n\n## Spec references\n- PLAN.md: v0.2 scope ('Core fingerprint: markdown.v0')\n- PLAN.md: Supported content formats table (markdown row)\n\n## Acceptance\n- markdown.v0 registered as builtin\n- Matches any valid markdown file with headings\n- Content assertions available on matched documents\n- Fingerprint definition is minimal and general-purpose\n- Unit test for match/no-match","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-27T00:19:18.300102Z","created_by":"zac","updated_at":"2026-02-27T01:34:14.922014Z","closed_at":"2026-02-27T01:34:14.921853Z","close_reason":"Added markdown.v0 builtin fingerprint and tests for heading-required markdown matching","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-208","depends_on_id":"bd-1iy","type":"blocks","created_at":"2026-02-27T00:22:21.757659Z","created_by":"zac"},{"issue_id":"bd-208","depends_on_id":"bd-me0","type":"blocks","created_at":"2026-02-27T00:22:21.816167Z","created_by":"zac"}]}
{"id":"bd-22r","title":"PRM-FP-0108: Compile mode","description":"DSL-to-Rust crate generation: parse .fp.yaml, generate Cargo.toml + src/lib.rs implementing Fingerprint trait, embed compiler metadata.\n\n## Files touched\nsrc/compile/mod.rs, src/compile/codegen.rs, src/compile/crate_gen.rs\n\n## Acceptance Criteria\n- fingerprint compile test.fp.yaml --out dir/ generates valid Rust crate\n- Generated crate: Cargo.toml, src/lib.rs implementing Fingerprint trait, fixtures/ stubs\n- Embeds: compiler_version, source_hash (blake3 of canonicalized YAML), source: dsl\n- Deterministic: same YAML → same Rust source (byte-identical)\n- --check mode: validates YAML without generating code\n- Compile refusals: E_INVALID_YAML, E_UNKNOWN_ASSERTION, E_MISSING_FIELD\n- Exit codes: 0 (clean), 1 (warnings), 2 (refusal)\n- No witness records produced in compile mode\n- Unit tests for codegen determinism\n\n## Depends on\nPRM-FP-0102 (DSL parser)","status":"closed","priority":1,"issue_type":"feature","assignee":"zac","created_at":"2026-02-26T11:20:28.125705Z","created_by":"zac","updated_at":"2026-02-27T01:39:07.567782Z","closed_at":"2026-02-27T01:39:07.567678Z","close_reason":"done","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-22r","depends_on_id":"bd-f6u","type":"blocks","created_at":"2026-02-26T11:20:57.773260Z","created_by":"zac"}]}
{"id":"bd-23q","title":"PRM-FP-0101a: Document dispatch + raw","description":"Fill in document/dispatch.rs (Document enum, Document::open() format dispatch by extension) and document/raw.rs (RawDocument fallback). Uses stub types from scaffold for Xlsx/Csv/Pdf variants.\n\nFILES: src/document/dispatch.rs, src/document/raw.rs (2 files)\nVERIFY: cargo test --lib -- document::dispatch && cargo test --lib -- document::raw","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:19:26.602510Z","created_by":"zac","updated_at":"2026-02-27T00:45:43.220796Z","closed_at":"2026-02-27T00:45:43.220675Z","close_reason":"Implemented document dispatch by extension and RawDocument with comprehensive tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-23q","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:20:57.157930Z","created_by":"zac"}]}
{"id":"bd-23t","title":"PRM-FP-0223: Binary stripping in release workflow","description":"Add platform-specific binary stripping to .github/workflows/release.yml before packaging. rvl has strip operations for linux (strip), macos (strip), linux-cross (aarch64-linux-gnu-strip). fingerprint release workflow currently ships unstripped binaries — larger artifacts than necessary.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-27T03:45:21.956404Z","created_by":"zac","updated_at":"2026-02-27T03:53:11.625792Z","closed_at":"2026-02-27T03:53:11.625687Z","close_reason":"Verified release workflow includes platform-specific stripping (linux, macOS, aarch64-linux cross) before packaging","compaction_level":0,"original_size":0}
{"id":"bd-25m","title":"PRM-FP-0107c: Pipeline parallel (parallel.rs)","description":"Fill in pipeline/parallel.rs: --jobs N parallel workers with bounded reorder buffer. Output order MUST match input order. Buffer bounds in-flight work (no unbounded growth). FILE: src/pipeline/parallel.rs (1 file). VERIFY: cargo test --lib -- pipeline::parallel","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:47:48.632468Z","created_by":"zac","updated_at":"2026-02-27T01:00:05.110738Z","closed_at":"2026-02-27T01:00:05.110637Z","close_reason":"Implemented bounded ordered parallel processing with pipeline::parallel tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-25m","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:29.390994Z","created_by":"zac"}]}
{"id":"bd-26d","title":"PRM-FP-0221: Cargo.toml package metadata","description":"Add missing package metadata to Cargo.toml: authors, description, license, repository, readme, keywords, categories. Match rvl's pattern. Required for crates.io publish and release workflow correctness.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-27T03:45:16.842454Z","created_by":"zac","updated_at":"2026-02-27T03:48:21.104229Z","closed_at":"2026-02-27T03:48:21.104069Z","close_reason":"Added complete package metadata to Cargo.toml: authors, description, license, repository, readme, keywords, categories for crates.io publish readiness.","compaction_level":0,"original_size":0}
{"id":"bd-28w","title":"Crate discovery — implement discover_installed() in registry/installed.rs","description":"## What\n\nsrc/registry/installed.rs discover_installed() is a stub returning Vec::new().\nsrc/lib.rs:439 has // TODO: Discover and register installed fingerprint crates.\nUntil this works, no compiled DSL fingerprint can be used in run mode — only builtins.\n\n## Acceptance\n\n- discover_installed() scans a well-defined location for compiled fingerprint crates\n- Each discovered crate is loaded and registered as Box<dyn Fingerprint>\n- fingerprint --list shows discovered crates alongside builtins\n- fingerprint --fp loan-tape.v1 resolves to the installed crate\n- Discovery location is documented (e.g. ~/.fingerprint/crates/, cargo install path, or env var)\n- The existing test discover_installed_is_empty_stub_for_v0_1 is replaced with real coverage\n\n## Context\n\nBlocked by nothing. Blocks all downstream use of DSL fingerprints in run mode.\nThe spine use case (outcomes/spine/) has loan-tape.v1 compiled and waiting.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-27T13:53:11.219882Z","created_by":"zacharyruiz","updated_at":"2026-02-27T14:17:51.745007Z","closed_at":"2026-02-27T14:17:51.744900Z","close_reason":"discover_installed() scans ~/.fingerprint/definitions/ for .fp.yaml files, wraps each in a DslFingerprint implementing the Fingerprint trait via evaluate_named_assertions + extract + content_hash, and registers with FingerprintInfo. Wired into build_registry(). Override scan dir with FINGERPRINT_DEFINITIONS env var.","compaction_level":0,"original_size":0,"labels":["registry","spine"]}
{"id":"bd-2c7","title":"PRM-FP-0100b: CLI args (cli/args.rs)","description":"Fill in cli/args.rs: full clap derive Cli struct, Command enum (Compile, Witness), WitnessAction enum per PLAN.md. FILE: src/cli/args.rs (1 file). VERIFY: cargo test --lib -- cli::args","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:35:23.534614Z","created_by":"zac","updated_at":"2026-02-27T00:47:50.626227Z","closed_at":"2026-02-27T00:47:50.625898Z","close_reason":"Implemented clap Cli/Command/WitnessAction and added cli::args parser tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2c7","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:28.793369Z","created_by":"zac"}]}
{"id":"bd-2fj","title":"PRM-FP-0001: Release infra parity audit vs rvl","description":"Audit fingerprint release/build automation against rvl baseline and produce an actionable parity matrix. Scope is documentation + bead planning only; no workflow code changes in this issue.\n\n## Acceptance Criteria\n- Create docs/RELEASE_PARITY_AUDIT.md with side-by-side matrix (ci.yml, release.yml, checksums/signing, SBOM/provenance, Homebrew update path); classify each row as keep/adapt/defer with rationale; link each open gap to a specific bead ID and confirm no unmatched gaps remain.\n\n## Notes\nBoundary: repo automation parity only. Do not change fingerprint runtime/spec behavior in this bead.","acceptance_criteria":"Create docs/RELEASE_PARITY_AUDIT.md with side-by-side matrix (ci.yml, release.yml, checksums/signing, SBOM/provenance, Homebrew update path); classify each row as keep/adapt/defer with rationale; link each open gap to a specific bead ID and confirm no unmatched gaps remain.","notes":"Boundary: repo automation parity only. Do not change fingerprint runtime/spec behavior in this bead.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-25T03:58:30.780902Z","created_by":"zac","updated_at":"2026-02-27T03:19:17.708936Z","closed_at":"2026-02-27T03:19:17.708844Z","close_reason":"Added docs/RELEASE_PARITY_AUDIT.md with requested side-by-side release parity matrix (ci.yml/release.yml/checksums-signing/SBOM-provenance/Homebrew), keep/adapt/defer classifications, and full bead mapping with no unmatched gaps","compaction_level":0,"original_size":0,"labels":["infra","parity","release"]}
{"id":"bd-2hm","title":"PRM-FP-0101b: XLSX document (document/xlsx.rs)","description":"Fill in document/xlsx.rs: XlsxDocument with calamine — list sheets, read cell by address, read range, sheet row count. No panics on malformed files. FILE: src/document/xlsx.rs (1 file). VERIFY: cargo test --lib -- document::xlsx","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:46:01.769860Z","created_by":"zac","updated_at":"2026-02-27T01:18:56.609764Z","closed_at":"2026-02-27T01:18:56.609657Z","close_reason":"Implemented XlsxDocument open/list/cell/range/row-count with robust tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2hm","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:28.906012Z","created_by":"zac"}]}
{"id":"bd-2ka","title":"PRM-FP-0009: Add golden-output determinism tests","description":"Add deterministic golden-output tests for JSONL and witness-record schema shape.\n\n## Acceptance Criteria\n- Create golden fixtures for matched, no-match, skipped, and refusal outputs; assert byte-stable JSONL serialization and content_hash determinism for identical inputs; assert witness record schema fields and stable key presence/order expectations used by downstream tools; include fixture regeneration instructions.\n\n## Notes\nBoundary: golden determinism only; command-surface smoke semantics belong in PRM-FP-0008.","acceptance_criteria":"Create golden fixtures for matched, no-match, skipped, and refusal outputs; assert byte-stable JSONL serialization and content_hash determinism for identical inputs; assert witness record schema fields and stable key presence/order expectations used by downstream tools; include fixture regeneration instructions.","notes":"Boundary: golden determinism only; command-surface smoke semantics belong in PRM-FP-0008.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-25T03:58:31.128628Z","created_by":"zac","updated_at":"2026-02-27T03:56:13.114359Z","closed_at":"2026-02-27T03:56:13.114209Z","close_reason":"Implemented comprehensive golden-output determinism tests in tests/golden_output_determinism.rs covering: byte-stable JSONL serialization across runs, content_hash determinism for identical inputs, witness record schema validation with stable field ordering, deterministic output for all CLI modes (run/infer/compile), deterministic error messages, deterministic fingerprint processing order, and deterministic content hashing. All acceptance criteria met.","compaction_level":0,"original_size":0,"labels":["determinism","golden","tests"],"dependencies":[{"issue_id":"bd-2ka","depends_on_id":"bd-14l","type":"blocks","created_at":"2026-02-25T04:04:32.048444Z","created_by":"zac"},{"issue_id":"bd-2ka","depends_on_id":"bd-9in","type":"blocks","created_at":"2026-02-25T04:02:09.819515Z","created_by":"zac"},{"issue_id":"bd-2ka","depends_on_id":"bd-tdc","type":"blocks","created_at":"2026-02-26T11:21:23.696866Z","created_by":"zac"}]}
{"id":"bd-2lg","title":"Spine integration: loan-tape.v1 end-to-end with content hash","description":"## What\n\nOnce discovery, extraction codegen, content hash codegen, and trust config are done,\nupdate outcomes/spine/run.sh to use --fp loan-tape.v1 instead of --fp csv.v0.\n\n## Acceptance\n\n- fingerprint --list shows loan-tape.v1 alongside builtins\n- fingerprint --fp loan-tape.v1 matches both jan.csv and feb.csv\n- Output records include all 11 assertions (filename, sheet, min_rows, 8 headers) as passed: true\n- extracted field contains real cell data from range A1:H20\n- content_hash field is \"blake3:<real_hash>\" (different for jan vs feb)\n- Lockfile members carry fingerprint.content_hash (not null)\n- Full pipeline passes: vacuum → hash → fingerprint → shape → rvl → lock → pack → verify\n- Evidence pack integrity verified\n\n## Context\n\nThis is the validation bead. The loan-tape.fp.yaml definition and compiled crate\nalready exist at outcomes/spine/. This bead wires them into the live pipeline.","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2026-02-27T13:55:29.591724Z","created_by":"zacharyruiz","updated_at":"2026-02-27T13:57:30.379021Z","closed_at":"2026-02-27T13:57:30.379021Z","deleted_at":"2026-02-27T13:57:30.379014Z","deleted_by":"zacharyruiz","delete_reason":"delete","original_type":"feature","compaction_level":0,"original_size":0,"labels":["integration","spine"]}
{"id":"bd-2ly","title":"PRM-FP-0200: fingerprint infer subcommand","description":"New third mode: learn fingerprint definitions from a corpus of example files. Deterministic corpus observation — no ML, no document content stored or transmitted. Zero-retention safe.\n\n## CLI\nfingerprint infer <DIR> --format <xlsx|csv|pdf> --id <name> [--min-confidence 0.9] [--no-extract] [--out <path>]\n\n## Algorithm\n1. Scan DIR for files matching --format\n2. Open each via Document::open() (same abstraction as run mode)\n3. Observe structural facts per file: sheet names, cell values at common positions, range population, row counts, filename patterns\n4. Aggregate across corpus: keep invariants above --min-confidence threshold\n5. Emit .fp.yaml with confidence annotations as YAML comments\n6. Optionally suggest extract sections (--no-extract to skip)\n7. Append witness record (tool: fingerprint, params: {mode: infer, corpus_size: N})\n\n## Structural facts observed (per format)\n- xlsx: sheet_exists, cell_eq, cell_regex (detect patterns across varying values), sheet_name_regex, range_non_null, sheet_min_rows\n- csv: filename_regex, header patterns, row count floor, column non-null rates\n- pdf: page count range, metadata field patterns, form field presence\n\n## Files\nsrc/infer/mod.rs (new), src/infer/observer.rs (per-file observation), src/infer/aggregator.rs (cross-corpus statistics), src/infer/emitter.rs (YAML generation with confidence comments). Also touches: src/cli/args.rs (add Infer variant to Command), src/lib.rs (add pub mod infer + dispatch).\n\n## Acceptance criteria\n- fingerprint infer tests/fixtures/ --format xlsx --id test produces valid .fp.yaml\n- Output YAML is valid input to fingerprint compile\n- Deterministic: same corpus same order = identical YAML\n- Confidence annotations present as comments\n- --min-confidence filters low-confidence assertions\n- --no-extract omits extract/content_hash sections\n- No document content in output (only structural metadata: sheet names, cell addresses, expected values, thresholds)\n- Witness record appended\n\n## Verification\ncargo test --lib -- infer && fingerprint infer tests/fixtures/ --format xlsx --id test-inferred | head -20","status":"closed","priority":1,"issue_type":"feature","assignee":"zac","created_at":"2026-02-26T12:20:27.214529Z","created_by":"zac","updated_at":"2026-02-27T03:46:43.968195Z","closed_at":"2026-02-27T03:46:43.967746Z","close_reason":"Implemented infer subcommand end-to-end (observer/aggregator/emitter), CLI wiring, witness append, and deterministic infer tests with quality gate passing","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2ly","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T12:20:38.496243Z","created_by":"zac"},{"issue_id":"bd-2ly","depends_on_id":"bd-23q","type":"blocks","created_at":"2026-02-26T12:20:38.608146Z","created_by":"zac"},{"issue_id":"bd-2ly","depends_on_id":"bd-2c7","type":"blocks","created_at":"2026-02-26T12:20:38.552068Z","created_by":"zac"},{"issue_id":"bd-2ly","depends_on_id":"bd-2hm","type":"blocks","created_at":"2026-02-26T12:20:38.664126Z","created_by":"zac"},{"issue_id":"bd-2ly","depends_on_id":"bd-ojz","type":"blocks","created_at":"2026-02-26T12:20:38.719479Z","created_by":"zac"},{"issue_id":"bd-2ly","depends_on_id":"bd-q7t","type":"blocks","created_at":"2026-02-26T12:20:38.774258Z","created_by":"zac"}]}
{"id":"bd-2p6","title":"PRM-FP-0002: Add rvl-style CI workflow baseline","description":"Implement baseline CI workflow parity with rvl for quality gates (fmt/clippy/test + basic binary smoke where applicable). This issue does not publish releases or manage tap updates.\n\n## Acceptance Criteria\n- Add .github/workflows/ci.yml; workflow runs on push and pull_request to main; includes fmt/clippy/test jobs and a final aggregate success gate; includes cross-platform build smoke on release/tag path (version/help); workflow YAML validates and executes without syntax/runtime errors.\n\n## Notes\nNon-goal: release publishing, signing, SBOM/provenance, or Homebrew updates.","acceptance_criteria":"Add .github/workflows/ci.yml; workflow runs on push and pull_request to main; includes fmt/clippy/test jobs and a final aggregate success gate; includes cross-platform build smoke on release/tag path (version/help); workflow YAML validates and executes without syntax/runtime errors.","notes":"Non-goal: release publishing, signing, SBOM/provenance, or Homebrew updates.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-25T03:58:30.824185Z","created_by":"zac","updated_at":"2026-02-27T01:29:46.845653Z","closed_at":"2026-02-27T01:29:46.845536Z","close_reason":"Existing .github/workflows/ci.yml satisfies baseline fmt/clippy/test + tag smoke + aggregate gate acceptance","compaction_level":0,"original_size":0,"labels":["ci","infra","release"],"dependencies":[{"issue_id":"bd-2p6","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:21:23.401521Z","created_by":"zac"}]}
{"id":"bd-2rs","title":"PRM-FP-0209: Content extract types + content hash","description":"Implement content extract types and content hash computation over extracted content sections.\n\n## Extract types\n1. `table`: captures full markdown table (header + rows) under anchor_heading at index\n   - Output: { start_line, end_line, columns: [...], row_count }\n2. `section`: captures all content from heading to next heading at equal/lesser depth\n   - Output: { start_line, end_line, heading: 'actual heading text' }\n3. `text_match`: captures matched text near an anchor\n   - Output: { line, char_offset, matched: 'matched text' }\n\n## Content hash\n- BLAKE3 over concatenated extracted content sections listed in `content_hash.over`\n- Extraction is deterministic: same document + same fingerprint + same extraction → same hash\n- Hash computed only on match (null when matched: false)\n- Content hash reflects extracted text, not original file bytes (that's bytes_hash)\n- Only comparable within same extraction tool + version\n\n## Spec references\n- PLAN.md: Content extract types section (with table of types)\n- PLAN.md: Content hash and extraction tool versioning section\n- PLAN.md: Extract invariants (deterministic, stable section references)\n\n## Acceptance\n- Each extract type produces correct output structure\n- Content hash is BLAKE3 over concatenated extracts in `over` order\n- Hash is null when fingerprint doesn't match\n- Same content + same fingerprint → same hash (determinism test)\n- Unit tests for each extract type and hash computation","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T23:46:20.588508Z","created_by":"zac","updated_at":"2026-02-27T01:19:57.155277Z","closed_at":"2026-02-27T01:19:57.155170Z","close_reason":"Implemented extract types (table/section/text_match), deterministic BLAKE3 content_hash over selected sections, and comprehensive extract/hash unit tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2rs","depends_on_id":"bd-1iy","type":"blocks","created_at":"2026-02-27T00:21:06.049623Z","created_by":"zac"}]}
{"id":"bd-341","title":"PRM-FP-0226: Test coverage parity — expand test files and fixtures","description":"Expand test coverage to close the gap with rvl (currently 4 test files / 1,076 lines / 17 fixtures vs rvl's 20 / 3,382 / 120).\n\nTarget areas:\n- Content assertion edge cases (text_near bidirectional, table_shape type inference, markdown normalization)\n- Chained fingerprint scenarios (parent+children, orphan, E_NO_TEXT fallback)\n- Pipeline ordering under parallel execution\n- Golden-output determinism tests (same input → same output byte-for-byte)\n- Refusal path coverage (each E_* code with detail schema verification)\n- Fixture corpus: add sample markdown docs (CBRE-like), PDFs with metadata, extraction tool output variations\n- Fixture READMEs explaining organization (match rvl's tests/fixtures/corpus/README.md pattern)\n\nThis is the biggest real gap — test coverage is the foundation for shipping with confidence to the CBRE client.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-27T03:45:37.879972Z","created_by":"zac","updated_at":"2026-02-27T03:54:32.762486Z","closed_at":"2026-02-27T03:54:32.762353Z","close_reason":"Expanded parity-focused tests and fixtures coverage: infer/infer-schema integration, determinism, refusal coverage, chained scenarios, and content assertion edge cases with full quality gate passing","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-341","depends_on_id":"bd-14l","type":"blocks","created_at":"2026-02-27T03:46:11.875042Z","created_by":"zac"}]}
{"id":"bd-36b","title":"Codegen: wire range extraction to dsl::extract::extract()","description":"## What\n\nsrc/compile/codegen.rs generate_extracted_code() (line 200-218) emits a TODO placeholder:\n```rust\n// TODO: Implement extraction for type: range\nextracted.insert(\"primary_rows\".to_owned(), json!(\"extracted_placeholder\"));\n```\n\nThe actual extraction logic already exists in src/dsl/extract.rs as pub fn extract().\nCodegen needs to generate code that calls it instead of emitting a placeholder.\n\n## Acceptance\n\n- generate_extracted_code() produces Rust source that calls dsl::extract::extract(doc, &sections)\n- Generated code passes extracted HashMap<String, Value> to the content hash step\n- For type: range, the generated code extracts the specified cell range from the document\n- Compile a test .fp.yaml with extract sections — generated crate returns real extracted data\n- The loan-tape.v1 generated crate extracts A1:H20 from the loan tape CSVs\n\n## Context\n\nThe extraction functions are already public in dsl/extract.rs. This is a codegen wiring issue,\nnot a missing feature. The extracted field in the output record should contain real cell data,\nnot \"extracted_placeholder\".","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-27T13:53:40.504980Z","created_by":"zacharyruiz","updated_at":"2026-02-27T14:17:44.919199Z","closed_at":"2026-02-27T14:17:44.919097Z","close_reason":"generate_extracted_code now emits code that constructs ExtractSection structs and calls fingerprint::dsl::extract::extract(doc, &sections) instead of placeholder values","compaction_level":0,"original_size":0,"labels":["codegen","spine"]}
{"id":"bd-374","title":"PRM-FP-0100c: CLI exit codes (cli/exit.rs)","description":"Fill in cli/exit.rs: Outcome enum (AllMatched, Partial, Refusal) with exit_code() → u8 mapping (0/1/2). FILE: src/cli/exit.rs (1 file). VERIFY: cargo test --lib -- cli::exit","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:35:37.352308Z","created_by":"zac","updated_at":"2026-02-27T00:44:43.303533Z","closed_at":"2026-02-27T00:44:43.303409Z","close_reason":"Implemented Outcome exit_code mapping and added cli::exit unit tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-374","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:28.849931Z","created_by":"zac"}]}
{"id":"bd-38g","title":"PRM-FP-0104b: Output JSONL (output/jsonl.rs)","description":"Fill in output/jsonl.rs: serialize enriched JSONL records to stdout, one per line. Handle both normal records and refusal envelopes. FILE: src/output/jsonl.rs (1 file). VERIFY: cargo test --lib -- output::jsonl","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:47:21.690386Z","created_by":"zac","updated_at":"2026-02-27T00:50:20.900839Z","closed_at":"2026-02-27T00:50:20.900726Z","close_reason":"Implemented JSONL output writer for records/refusals with output::jsonl unit tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-38g","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:29.122999Z","created_by":"zac"}]}
{"id":"bd-38i","title":"PRM-FP-0207: Content assertions — table","description":"Implement table content assertions in the DSL assertion engine.\n\n## Assertion types\n1. table_exists: markdown table exists under heading → matched: bool\n2. table_columns: table columns match regex patterns → matched: bool\n3. table_shape: table has expected column count + inferred types → matched: bool\n4. table_min_rows: table has ≥ N data rows → matched: bool\n\n## Index parameter\nAll table assertions take optional `index: usize` (0-based, default 0) to target a specific table under the heading. Multiple tables under one heading are common in extracted documents.\n\n## table_columns semantics\n- `patterns` is a list of regex patterns, one per expected column\n- Patterns are matched in order against the table header row\n- Regex absorbs extraction tool variation ('Tenant Name' vs 'Tenant', 'Sq. Ft.' vs 'SF')\n\n## table_shape type inference rules\n- Strip markdown formatting before inference (**bold** → bold)\n- Types: number, currency, percentage, date, empty, string\n- Per-column type = majority vote (>50% of non-empty cells)\n- currency is a subtype of number (matches both ways)\n- No majority → string fallback\n\n## Spec references\n- PLAN.md: Content assertions table (table_* rows)\n- PLAN.md: table_shape column type inference rules section\n- PLAN.md: Why index / Why table_columns uses regex / Why table_shape sections\n\n## Acceptance\n- table_exists finds Nth table under regex-matched heading\n- table_columns matches regex patterns against header row\n- table_shape infers column types via majority vote with markdown stripping\n- table_min_rows counts data rows (excludes header + separator)\n- index=0 is default when omitted\n- Unit tests for each assertion + type inference edge cases","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T23:46:04.007553Z","created_by":"zac","updated_at":"2026-02-27T01:13:03.321326Z","closed_at":"2026-02-27T01:13:03.321220Z","close_reason":"Table content assertions fully implemented with comprehensive type inference and index support","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-38i","depends_on_id":"bd-1iy","type":"blocks","created_at":"2026-02-27T00:21:05.977828Z","created_by":"zac"}]}
{"id":"bd-3az","title":"PRM-FP-0227: Benchmarks suite (benches/)","description":"Add benchmarks directory with performance baselines. rvl has benches/bakeoff.rs (13KB comparing CSV parsers) and benches/runtime.rs. fingerprint needs:\n- benches/assertion_throughput.rs: assertions/sec on sample corpus\n- benches/pipeline_throughput.rs: records/sec end-to-end\n- benches/normalization.rs: markdown normalization pass performance\n- Cargo.toml [[bench]] harness entries\n- Establish baseline numbers before optimization work begins.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-27T03:45:41.721555Z","created_by":"zac","updated_at":"2026-02-27T04:23:21.721994Z","closed_at":"2026-02-27T04:23:21.720886Z","close_reason":"done","compaction_level":0,"original_size":0}
{"id":"bd-3cv","title":"PRM-FP-0107b: Pipeline reader (reader.rs)","description":"Fill in pipeline/reader.rs: parse JSONL from stdin or file, validate version field, validate bytes_hash on non-skipped records. Return typed errors for E_BAD_INPUT cases. FILE: src/pipeline/reader.rs (1 file). VERIFY: cargo test --lib -- pipeline::reader","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:47:48.579222Z","created_by":"zac","updated_at":"2026-02-27T00:56:35.386282Z","closed_at":"2026-02-27T00:56:35.386179Z","close_reason":"Implemented JSONL reader validation for version/bytes_hash with typed bad-input errors and pipeline::reader tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3cv","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:29.336004Z","created_by":"zac"}]}
{"id":"bd-3g1","title":"Trust config: load allowlist from config file","description":"## What\n\nsrc/lib.rs:442 has let allowlist: Vec<String> = vec![]; // TODO: Load from config.\nExternal fingerprint crates are rejected as untrusted (E_UNTRUSTED_FP) because the\nallowlist is always empty. Once discover_installed() finds crates, they will be blocked\nby the trust check unless the allowlist is populated.\n\n## Acceptance\n\n- Allowlist loaded from a config file (e.g. ~/.fingerprint/trust.yaml or .fingerprint/trust.yaml)\n- Config format supports allowlisting by crate name, fingerprint ID, or provider\n- Builtins remain always-trusted (no config needed)\n- Clear error message when an external fingerprint is blocked: shows how to add to allowlist\n- Config file location documented\n\n## Context\n\nGate between discovery and registration. Without this, discovered crates cannot be used.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-27T13:55:13.982902Z","created_by":"zacharyruiz","updated_at":"2026-02-27T14:17:54.396305Z","closed_at":"2026-02-27T14:17:54.396200Z","close_reason":"Trust config loaded from ~/.fingerprint/trust.yaml and .fingerprint/trust.yaml (project). Format: trust: [\"installed:*\"]. Wildcards supported in is_trusted_source. Override with FINGERPRINT_TRUST env var. Refusal message now shows exact trust.yaml entry to add.","compaction_level":0,"original_size":0,"labels":["registry","security"]}
{"id":"bd-3h3","title":"PRM-FP-0210: Assertion naming (optional name field + auto-generation)","description":"Add optional name field to DSL assertions with auto-generated fallback names.\n\n## Deliverables\n- DSL parser accepts optional `name` field on any assertion\n- Auto-generation rules when name is omitted:\n  - heading_regex → heading_regex__<first 20 chars of pattern>\n  - table_exists → table_exists__<heading excerpt>__<index>\n  - cell_eq → cell_eq__<sheet>__<cell>\n  - text_near → text_near__<anchor excerpt>\n  - General pattern: <type>__<distinguishing_field_excerpt>\n- Name appears in AssertionResult output\n- Name used in --diagnose output and failure aggregation\n\n## Why this matters\nWith 15 assertions across parent + children, auto-generated names are unreadable. Named assertions make failure aggregation with jq immediately actionable.\n\n## Spec references\n- PLAN.md: Assertion naming section\n- PLAN.md: CBRE example with named assertions\n\n## Acceptance\n- DSL parser accepts `name` field on any assertion type\n- Omitted name generates deterministic auto-name from type + key field\n- Name appears in assertion results JSON output\n- Auto-names are truncated (20 char excerpts)\n- Unit tests for auto-generation rules per assertion type","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T23:46:30.112922Z","created_by":"zac","updated_at":"2026-02-27T01:32:08.524680Z","closed_at":"2026-02-27T01:32:08.524578Z","close_reason":"Assertion naming auto-generation is deterministic and tests now pass with 20-char excerpts","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3h3","depends_on_id":"bd-me0","type":"blocks","created_at":"2026-02-27T00:22:17.448201Z","created_by":"zac"}]}
{"id":"bd-3j6","title":"PRM-FP-0010: Enforce coverage in CI","description":"Enforce required test suites in CI after suite implementation is complete.\n\n## Acceptance Criteria\n- CI fails if unit/integration/smoke/golden suites fail or are skipped; CI summary clearly reports each suite status; protection-ready aggregate job exists for branch rules; documentation describes required suites and local command to reproduce gates.\n\n## Notes\nDepends on CI baseline and all test-suite beads; this issue should only wire enforcement, not invent new tests.","acceptance_criteria":"CI fails if unit/integration/smoke/golden suites fail or are skipped; CI summary clearly reports each suite status; protection-ready aggregate job exists for branch rules; documentation describes required suites and local command to reproduce gates.","notes":"Depends on CI baseline and all test-suite beads; this issue should only wire enforcement, not invent new tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T03:58:31.169547Z","created_by":"zac","updated_at":"2026-02-27T03:57:40.682578Z","closed_at":"2026-02-27T03:57:40.682395Z","close_reason":"Enforced unit/integration/smoke/golden suites in CI with explicit jobs, protection-ready aggregate gate, suite status summary, and documented local reproduction commands","compaction_level":0,"original_size":0,"labels":["ci","coverage","tests"],"dependencies":[{"issue_id":"bd-3j6","depends_on_id":"bd-18y","type":"blocks","created_at":"2026-02-25T03:58:43.667929Z","created_by":"zac"},{"issue_id":"bd-3j6","depends_on_id":"bd-1rw","type":"blocks","created_at":"2026-02-26T11:48:39.989065Z","created_by":"zac"},{"issue_id":"bd-3j6","depends_on_id":"bd-1zd","type":"blocks","created_at":"2026-02-25T03:58:43.626258Z","created_by":"zac"},{"issue_id":"bd-3j6","depends_on_id":"bd-2ka","type":"blocks","created_at":"2026-02-25T03:58:43.751361Z","created_by":"zac"},{"issue_id":"bd-3j6","depends_on_id":"bd-2p6","type":"blocks","created_at":"2026-02-25T04:04:32.185283Z","created_by":"zac"},{"issue_id":"bd-3j6","depends_on_id":"bd-kmi","type":"blocks","created_at":"2026-02-25T03:58:43.706663Z","created_by":"zac"}]}
{"id":"bd-3o0","title":"PRM-FP-0004: Wire Homebrew release path parity","description":"Add Homebrew/tap update path parity using produced release artifacts and checksums from release workflow.\n\n## Acceptance Criteria\n- Workflow/job updates fingerprint formula with current version and per-target checksums; automation references published release artifacts and SHA256SUMS; resulting formula supports install verification path equivalent to rvl tap behavior; dry-run/validation step confirms generated formula syntax and URLs.\n\n## Notes\nBoundary: formula automation only; avoid rebuilding release artifacts in this bead.","acceptance_criteria":"Workflow/job updates fingerprint formula with current version and per-target checksums; automation references published release artifacts and SHA256SUMS; resulting formula supports install verification path equivalent to rvl tap behavior; dry-run/validation step confirms generated formula syntax and URLs.","notes":"Boundary: formula automation only; avoid rebuilding release artifacts in this bead.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-25T03:58:30.908642Z","created_by":"zac","updated_at":"2026-02-27T03:29:11.500140Z","closed_at":"2026-02-27T03:29:11.500032Z","close_reason":"Added Homebrew parity job in release workflow: derives formula checksums from published SHA256SUMS, generates fingerprint.rb with per-target URLs/checksums, validates Ruby syntax and asset URLs, uploads formula artifact, and optionally updates tap repo","compaction_level":0,"original_size":0,"labels":["brew","infra","release"],"dependencies":[{"issue_id":"bd-3o0","depends_on_id":"bd-poy","type":"blocks","created_at":"2026-02-25T04:04:32.137286Z","created_by":"zac"}]}
{"id":"bd-3pe","title":"PRM-FP-0106b: Registry builtins (builtin.rs)","description":"Fill in registry/builtin.rs: hand-coded Rust implementations of core fingerprints (csv.v0, xlsx.v0, pdf.v0). Each implements the Fingerprint trait directly — no DSL parser dependency for v0.1. Simple format-matching + basic structural checks. FILE: src/registry/builtin.rs (1 file). VERIFY: cargo test --lib -- registry::builtin","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:47:40.093505Z","created_by":"zac","updated_at":"2026-02-27T01:13:31.462008Z","closed_at":"2026-02-27T01:13:31.461898Z","close_reason":"Implemented csv.v0/xlsx.v0/pdf.v0 builtins with registry::builtin tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3pe","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:29.282067Z","created_by":"zac"}]}
{"id":"bd-3qx","title":"PRM-FP-0103b: DSL extract + content hash","description":"Fill in dsl/extract.rs (content extraction from matched documents into HashMap) and dsl/content_hash.rs (BLAKE3 over extracted sections, deterministic). Same doc + same fp + same extraction = same hash. FILES: src/dsl/extract.rs, src/dsl/content_hash.rs (2 files). VERIFY: cargo test --lib -- dsl::extract && cargo test --lib -- dsl::content_hash","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:47:12.605883Z","created_by":"zac","updated_at":"2026-02-27T01:10:12.102621Z","closed_at":"2026-02-27T01:10:12.102355Z","close_reason":"Implemented extract section resolution and deterministic content hashing with tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3qx","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:29.069364Z","created_by":"zac"}]}
{"id":"bd-3v7","title":"PRM-FP-0103a: DSL assertions","description":"Fill in dsl/assertions.rs: Assertion enum evaluate() for all 7 v0.1 types (filename_regex, sheet_exists, sheet_name_regex, cell_eq, cell_regex, range_non_null, sheet_min_rows). Short-circuit on first failure. Uses Document stub methods from scaffold; agent creates inline test fixtures.\n\nFILE: src/dsl/assertions.rs (1 file)\nVERIFY: cargo test --lib -- dsl::assertions","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:19:43.134067Z","created_by":"zac","updated_at":"2026-02-27T00:51:34.102482Z","closed_at":"2026-02-27T00:51:34.102318Z","close_reason":"Implemented v0.1 DSL assertion evaluation with tests and format-aware dispatch wiring","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3v7","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:59.342186Z","created_by":"zac"}]}
{"id":"bd-412","title":"PRM-FP-0005: Test coverage parity plan vs rvl","description":"Audit current fingerprint tests against rvl coverage model (unit, integration, smoke, golden, witness command coverage). Produce missing-test matrix and convert it into executable test beads.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T03:58:30.953053Z","created_by":"zac","updated_at":"2026-02-25T04:02:20.777981Z","closed_at":"2026-02-25T04:02:20.777887Z","close_reason":"parity matrix completed and gaps converted to executable beads","compaction_level":0,"original_size":0,"labels":["coverage","parity","tests"],"comments":[{"id":1,"issue_id":"bd-412","author":"Zac","text":"Completed PRM-FP-0005 parity review. Added docs/TEST_COVERAGE_PARITY.md with evidence-based matrix versus rvl (213 src tests, 111 integration tests, 120 fixture files baseline vs 0 today in fingerprint). Confirmed all identified gaps are mapped to executable beads; added bd-9in for fixture corpus and linked dependencies from bd-1zd/bd-18y/bd-kmi/bd-2ka.","created_at":"2026-02-25T04:02:20Z"}]}
{"id":"bd-7wx","title":"PRM-FP-0215: Docling integration docs (README + pipeline)","description":"Document the Docling integration pipeline in the README and ensure PLAN.md pipeline examples are correct.\n\n## Deliverables\n- README.md section: 'Using with Docling (PDF content fingerprinting)'\n  - Prerequisites: pip install docling\n  - Batch extraction: docling --input-dir /data/ --to md --output /data/\n  - Pipeline: vacuum | hash | jq text_path injection | fingerprint\n  - Chained fingerprints example with parent + children\n- Corpus-level failure analysis patterns (jq recipes):\n  - Count failures by assertion name\n  - Show diagnostic context for specific assertion across corpus\n  - Nearest heading matches for heading_regex failures\n- Alternative tools table: Docling vs llm_aided_ocr vs pdftotext\n- Air-gap note: Docling 258M VLM runs fully local, no data leaves machine\n\n## Spec references\n- PLAN.md: PDF Content Pipeline (Docling Integration) section\n- PLAN.md: Corpus-level failure analysis jq patterns\n\n## Acceptance\n- README has clear Docling setup and pipeline instructions\n- jq text_path injection pattern documented\n- Corpus failure analysis jq recipes included\n- Alternative tools mentioned with quality/capability comparison","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-27T00:19:18.478962Z","created_by":"zac","updated_at":"2026-02-27T01:37:29.107598Z","closed_at":"2026-02-27T01:37:29.107491Z","close_reason":"Added README Docling pipeline section with text_path injection, chained examples, corpus jq diagnostics, and extractor comparison","compaction_level":0,"original_size":0}
{"id":"bd-9in","title":"PRM-FP-0011: Build core fixture corpus for fingerprint tests","description":"Create core fixture corpus required for initial unit/integration/smoke/golden bring-up: representative csv/xlsx/pdf samples, hashed manifests, and minimal skipped/refusal triggers.\n\n## Acceptance Criteria\n- Add tests/fixtures with core happy-path files for csv/xlsx/pdf; add hashed manifest fixtures for pipeline tests; add at least one corrupt/parse-fail fixture and one malformed-input manifest fixture for refusal path; document fixture inventory in tests/fixtures/README.md with intended test usage.\n\n## Notes\nKeep scope to core bring-up corpus; advanced edge-case fixtures move to PRM-FP-0012.","acceptance_criteria":"Add tests/fixtures with core happy-path files for csv/xlsx/pdf; add hashed manifest fixtures for pipeline tests; add at least one corrupt/parse-fail fixture and one malformed-input manifest fixture for refusal path; document fixture inventory in tests/fixtures/README.md with intended test usage.","notes":"Keep scope to core bring-up corpus; advanced edge-case fixtures move to PRM-FP-0012.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-25T04:01:59.988470Z","created_by":"zac","updated_at":"2026-02-27T03:22:08.000372Z","closed_at":"2026-02-27T03:22:08.000214Z","close_reason":"Added core fixture corpus under tests/fixtures (happy CSV/XLSX/PDF + markdown text_path, corrupt parse-fail file, hashed manifest fixtures, malformed-input manifest) and documented inventory/usage in tests/fixtures/README.md","compaction_level":0,"original_size":0,"labels":["fixtures","parity","tests"]}
{"id":"bd-b1b","title":"PRM-FP-0211: --diagnose flag (context-rich assertion failures)","description":"Implement --diagnose CLI flag for context-rich assertion failure output.\n\n## Behavior\n- --diagnose disables short-circuit: ALL assertions are evaluated even after first failure\n- Failed assertions include a `context` field showing what the document actually contains\n- Turns 'your regex didn't match' into 'here's what you should have written'\n\n## Diagnostic context per assertion type\n- heading_exists / heading_regex: { headings_found: [...], nearest_match: '...' }\n- text_contains / text_regex: { partial_matches: [...] } (up to 5 near-misses)\n- text_near: { anchor_found: bool, matches_outside_range: [...] }\n- table_exists / table_columns / table_shape: { tables_found: [...with columns/rows], heading_found: bool }\n- section_non_empty / section_min_lines: { section_lines: N, heading_found: bool }\n\n## Implementation\n- AssertionResult gains `context: Option<serde_json::Value>` field\n- Context is only populated when --diagnose is active\n- Without --diagnose, short-circuit on first failure (existing behavior) and no context\n\n## Spec references\n- PLAN.md: Diagnostic context (--diagnose) section\n- PLAN.md: Diagnostic context table and example output\n\n## Acceptance\n- --diagnose evaluates all assertions (no short-circuit)\n- Each assertion type produces correct context on failure\n- Context is null/absent without --diagnose\n- nearest_match uses edit distance for heading failures\n- Unit tests for diagnostic context per assertion type","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T23:46:39.327593Z","created_by":"zac","updated_at":"2026-02-27T03:17:33.610568Z","closed_at":"2026-02-27T03:17:33.610472Z","close_reason":"Implemented --diagnose flag wiring, AssertionResult.context diagnostic payloads (heading/text/text_near/table/section), diagnose-mode no-short-circuit behavior in generated assertion flow, and validated with cargo fmt --check && cargo clippy --all-targets -- -D warnings && cargo test","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-b1b","depends_on_id":"bd-38i","type":"blocks","created_at":"2026-02-27T00:22:17.571445Z","created_by":"zac"},{"issue_id":"bd-b1b","depends_on_id":"bd-me0","type":"blocks","created_at":"2026-02-27T00:22:17.509762Z","created_by":"zac"}]}
{"id":"bd-cmn","title":"PRM-FP-0201: compile --schema (DSL JSON Schema output)","description":"Add --schema flag to the compile subcommand that prints the JSON Schema for .fp.yaml fingerprint definitions to stdout and exits 0. This is the machine-readable contract for what the DSL accepts — assertion types, required fields, value constraints.\n\n## CLI\nfingerprint compile --schema\n\n## Output\nJSON Schema document describing valid .fp.yaml structure:\n- fingerprint_id (string, required)\n- format (enum: xlsx, csv, pdf)\n- assertions (array of assertion objects, each typed)\n- extract (array of extraction specs, optional)\n- content_hash (algorithm + over fields, optional)\n- Per-assertion-type schemas: sheet_exists, cell_eq, cell_regex, range_non_null, sheet_min_rows, filename_regex, sheet_name_regex\n- Deferred types listed as known-but-unsupported (range_populated, sum_eq, within_tolerance)\n\n## Consumer\nPrimary consumer is cmdrvl-cli's fp infer-code, which calls this at runtime to inject the current DSL schema into LLM prompts. Ensures infer-code always matches the installed fingerprint version's capabilities.\n\n## Files\nsrc/compile/schema.rs (new, 1 file) — schema definition and serialization. Also touches src/cli/args.rs (add schema flag to Compile variant) and src/compile/mod.rs (dispatch).\n\n## Acceptance criteria\n- fingerprint compile --schema prints valid JSON Schema to stdout, exits 0\n- Schema validates the argus-model.fp.yaml example from PLAN.md\n- All 7 v0.1 assertion types have per-type sub-schemas\n- Deferred types (range_populated, sum_eq, within_tolerance) listed in schema with 'unsupported in v0.1' annotation\n- Schema is deterministic (same binary = same output)\n\n## Verification\nfingerprint compile --schema | python3 -m json.tool && echo 'valid JSON'","status":"closed","priority":1,"issue_type":"feature","assignee":"zac","created_at":"2026-02-26T12:22:58.568804Z","created_by":"zac","updated_at":"2026-02-27T03:16:16.128881Z","closed_at":"2026-02-27T03:16:16.128631Z","close_reason":"Implemented compile --schema CLI path, typed DSL JSON Schema (including v0.1 assertions + deferred annotations), and tests; quality gate + runtime schema validation passed","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-cmn","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T12:23:08.244911Z","created_by":"zac"},{"issue_id":"bd-cmn","depends_on_id":"bd-22r","type":"blocks","created_at":"2026-02-26T12:23:08.327565Z","created_by":"zac"}]}
{"id":"bd-f4n","title":"PRM-FP-0204: PdfDocument.text + format-aware assertion dispatch","description":"Add optional pre-extracted markdown to PdfDocument and implement format-aware assertion dispatch in the assertion engine.\n\n## Deliverables\n- PdfDocument gains `pub text: Option<MarkdownDocument>` field, loaded from text_path when present\n- Assertion dispatch table implemented in engine:\n  - pdf: structural (page_count, metadata_regex) from path; content (heading_*, text_*, section_*, table_*) from text_path\n  - markdown: all content assertions from path directly\n  - text: text_contains/text_regex/text_near from path directly\n  - xlsx/csv: all spreadsheet assertions from path\n- E_NO_TEXT behavior: content assertions fail with detail when text_path absent on format:pdf\n- text_path field parsed from JSONL input records\n\n## Spec references\n- PLAN.md: Assertion dispatch by format table\n- PLAN.md: E_NO_TEXT behavior\n- PLAN.md: Structural-only parent pattern\n\n## Acceptance\n- PdfDocument loads text_path markdown when present\n- Content assertions on format:pdf use text_path, not path\n- Structural assertions on format:pdf use path (the PDF)\n- Missing text_path causes content assertion failure with E_NO_TEXT detail\n- format:markdown ignores text_path, reads path directly\n- Unit tests for dispatch routing","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T23:45:37.141478Z","created_by":"zac","updated_at":"2026-02-27T00:51:42.113425Z","closed_at":"2026-02-27T00:51:42.113330Z","close_reason":"Implemented format-aware assertion dispatch with PdfDocument.text and E_NO_TEXT behavior","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-f4n","depends_on_id":"bd-1iy","type":"blocks","created_at":"2026-02-27T00:21:05.767878Z","created_by":"zac"}]}
{"id":"bd-f6u","title":"PRM-FP-0102: DSL parser","description":"Parse .fp.yaml fingerprint definitions into typed Rust structs: fingerprint_id, format, assertions list, extract sections, content_hash config.\n\n## Files touched\nsrc/dsl/mod.rs, src/dsl/parser.rs\n\n## Acceptance Criteria\n- Parses the argus-model.fp.yaml example from PLAN.md correctly\n- All v0.1 assertion types deserialize: filename_regex, sheet_exists, sheet_name_regex, cell_eq, cell_regex, range_non_null, sheet_min_rows\n- Extract sections parsed into typed structs\n- Content hash config (algorithm, over fields) parsed\n- Returns typed error for malformed YAML (E_INVALID_YAML, E_UNKNOWN_ASSERTION, E_MISSING_FIELD)\n- Unit tests for valid and invalid YAML inputs\n- Deferred assertions (range_populated, sum_eq, within_tolerance) rejected with clear error\n\n## Depends on\nPRM-FP-0100 (scaffold)","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:19:34.685806Z","created_by":"zac","updated_at":"2026-02-27T00:39:33.436394Z","closed_at":"2026-02-27T00:39:33.436275Z","close_reason":"Implemented DSL parser with content assertions and assertion naming","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-f6u","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:20:57.208008Z","created_by":"zac"}]}
{"id":"bd-hwe","title":"PRM-FP-0107a: Pipeline enricher","description":"Fill in pipeline/enricher.rs: for each JSONL record, try --fp list in order (first match wins), build fingerprint result. Handles upstream _skipped passthrough and new _skipped for IO/parse failures. Updates version to fingerprint.v0, merges tool_versions.\n\nFILE: src/pipeline/enricher.rs (1 file)\nVERIFY: cargo test --lib -- pipeline::enricher","status":"closed","priority":1,"issue_type":"feature","assignee":"zac","created_at":"2026-02-26T11:20:20.224108Z","created_by":"zac","updated_at":"2026-02-27T01:27:59.162150Z","closed_at":"2026-02-27T01:27:59.161925Z","close_reason":"Implemented enricher passthrough/skip/parse handling and first-match fingerprint selection with pipeline::enricher tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-hwe","depends_on_id":"bd-1f0","type":"blocks","created_at":"2026-02-26T11:20:57.724037Z","created_by":"zac"},{"issue_id":"bd-hwe","depends_on_id":"bd-1um","type":"blocks","created_at":"2026-02-26T11:20:57.674672Z","created_by":"zac"},{"issue_id":"bd-hwe","depends_on_id":"bd-23q","type":"blocks","created_at":"2026-02-26T11:20:57.624415Z","created_by":"zac"},{"issue_id":"bd-hwe","depends_on_id":"bd-38g","type":"blocks","created_at":"2026-02-26T11:48:39.489128Z","created_by":"zac"},{"issue_id":"bd-hwe","depends_on_id":"bd-3pe","type":"blocks","created_at":"2026-02-26T11:48:39.546376Z","created_by":"zac"}]}
{"id":"bd-hzs","title":"PRM-FP-0213: E_NO_TEXT + W_SPARSE_TEXT error/warning codes","description":"Implement E_NO_TEXT assertion failure and W_SPARSE_TEXT warning for PDF content fingerprinting.\n\n## E_NO_TEXT\n- When format:pdf and text_path is absent, content assertions fail with detail 'No text_path provided (E_NO_TEXT)'\n- Structural assertions (page_count, metadata_regex) still evaluated normally\n- This means a mixed structural+content fingerprint won't match without text_path\n- Structural-only parent pattern: parent with no content assertions matches without text_path; children fail with E_NO_TEXT, producing PARTIAL\n\n## W_SPARSE_TEXT\n- When format:pdf and text_path is present but suspiciously short (<100 chars for document with page_count >10)\n- Emits warning to stderr: { tool: 'fingerprint', code: 'W_SPARSE_TEXT', message: '...' }\n- Helps distinguish 'not this document type' from 'extraction tool failed'\n- Warning is non-fatal — assertion evaluation continues normally\n\n## Spec references\n- PLAN.md: E_NO_TEXT behavior in assertion dispatch section\n- PLAN.md: Scanned PDF detection section (W_SPARSE_TEXT)\n\n## Acceptance\n- Content assertions on format:pdf without text_path produce E_NO_TEXT detail\n- Structural assertions still work without text_path\n- W_SPARSE_TEXT emitted when text_path <100 chars and page_count >10\n- Warning is stderr-only, non-fatal\n- Unit tests for both paths","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T23:47:04.949557Z","created_by":"zac","updated_at":"2026-02-27T01:48:21.595780Z","closed_at":"2026-02-27T01:48:21.595682Z","close_reason":"Re-applied enricher with sparse-text warning path; validated with fmt/clippy/test","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-hzs","depends_on_id":"bd-f4n","type":"blocks","created_at":"2026-02-27T00:22:17.383961Z","created_by":"zac"}]}
{"id":"bd-kmi","title":"PRM-FP-0008: Add smoke tests for CLI surfaces","description":"Add smoke/E2E tests for CLI surfaces and witness subcommands.\n\n## Acceptance Criteria\n- Add smoke tests covering run mode invocation, compile mode invocation (including --check), --list, --describe, --schema, and witness query/last/count; assert documented exit-code routing (0/1/2) at process boundary; tests execute the built binary in temp workspace and avoid reliance on external services.\n\n## Notes\nNon-goal: byte-stable golden snapshots (handled by PRM-FP-0009).","acceptance_criteria":"Add smoke tests covering run mode invocation, compile mode invocation (including --check), --list, --describe, --schema, and witness query/last/count; assert documented exit-code routing (0/1/2) at process boundary; tests execute the built binary in temp workspace and avoid reliance on external services.","notes":"Non-goal: byte-stable golden snapshots (handled by PRM-FP-0009).","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-25T03:58:31.085316Z","created_by":"zac","updated_at":"2026-02-27T03:56:11.270300Z","closed_at":"2026-02-27T03:56:11.270127Z","close_reason":"Added CLI smoke/E2E coverage for describe/schema/list, compile/check, process-boundary exit routing (0/1/2), and witness query/last/count with built-binary integration tests","compaction_level":0,"original_size":0,"labels":["cli","smoke","tests"],"dependencies":[{"issue_id":"bd-kmi","depends_on_id":"bd-14l","type":"blocks","created_at":"2026-02-25T04:04:32.004569Z","created_by":"zac"},{"issue_id":"bd-kmi","depends_on_id":"bd-9in","type":"blocks","created_at":"2026-02-25T04:02:09.776223Z","created_by":"zac"},{"issue_id":"bd-kmi","depends_on_id":"bd-tdc","type":"blocks","created_at":"2026-02-26T11:21:23.645766Z","created_by":"zac"}]}
{"id":"bd-me0","title":"PRM-FP-0205: Content assertions — heading + text","description":"Implement heading and text content assertions in the DSL assertion engine.\n\n## Assertion types\n1. heading_exists: heading with exact text at any level → matched: bool\n2. heading_regex: any heading matches regex pattern → matched: bool\n3. heading_level: heading at specific level matching pattern → matched: bool (can defer)\n4. text_contains: exact substring found anywhere → matched: bool\n5. text_regex: regex matches anywhere in document → matched: bool\n6. text_near: regex matches within N chars of anchor → matched: bool + extracted value\n\n## text_near semantics (critical)\n- Bidirectional: within_chars measures distance in both directions from anchor\n- Multi-match: passes if ANY occurrence of anchor has pattern within range\n- Distance measurement: chars from end of anchor match to start of pattern match, ignoring whitespace gaps < 10 chars\n- First match found is reported in extracted\n\n## Spec references\n- PLAN.md: Content assertions table\n- PLAN.md: text_near search semantics section\n- PLAN.md: DSL assertion types\n\n## Acceptance\n- Each assertion type returns AssertionResult with passed, detail, extracted\n- text_near handles bidirectional search correctly\n- text_near handles multiple anchor occurrences (any match = pass)\n- heading_regex uses regex, heading_exists uses exact text match\n- All assertions work on MarkdownDocument and TextDocument (where applicable)\n- Unit tests for each assertion type including edge cases","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T23:45:46.007124Z","created_by":"zac","updated_at":"2026-02-27T01:04:18.045786Z","closed_at":"2026-02-27T01:04:18.045665Z","close_reason":"Implemented heading/text content assertions (heading_exists, heading_regex, heading_level, text_contains, text_regex, text_near) with format-aware routing, E_NO_TEXT behavior, and edge-case unit coverage","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-me0","depends_on_id":"bd-12h","type":"blocks","created_at":"2026-02-27T00:22:17.254390Z","created_by":"zac"},{"issue_id":"bd-me0","depends_on_id":"bd-1iy","type":"blocks","created_at":"2026-02-27T00:21:05.838619Z","created_by":"zac"}]}
{"id":"bd-ojz","title":"PRM-FP-0101c: CSV document (document/csv.rs)","description":"Fill in document/csv.rs: CsvDocument with csv crate — read headers, iterate rows, cell access by column. FILE: src/document/csv.rs (1 file). VERIFY: cargo test --lib -- document::csv","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:46:01.826896Z","created_by":"zac","updated_at":"2026-02-27T01:20:04.574537Z","closed_at":"2026-02-27T01:20:04.574426Z","close_reason":"CSV document implementation verified and aligned after syntax repair","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-ojz","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:28.960510Z","created_by":"zac"}]}
{"id":"bd-poy","title":"PRM-FP-0013: Release attestations and signing parity","description":"Add supply-chain release artifacts after base release workflow: checksums, signatures, SBOM, and provenance.\n\n## Acceptance Criteria\n- Release workflow emits SHA256SUMS over distributable archives; cosign signature/certificate artifacts are published with release; CycloneDX SBOM artifact is published with release; provenance statement artifact is published with release; failures in these steps fail the release job.\n\n## Notes\nDepends on base release workflow; do not duplicate build-matrix logic here.","acceptance_criteria":"Release workflow emits SHA256SUMS over distributable archives; cosign signature/certificate artifacts are published with release; CycloneDX SBOM artifact is published with release; provenance statement artifact is published with release; failures in these steps fail the release job.","notes":"Depends on base release workflow; do not duplicate build-matrix logic here.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-25T04:04:27.633302Z","created_by":"zac","updated_at":"2026-02-27T03:25:10.273093Z","closed_at":"2026-02-27T03:25:10.272849Z","close_reason":"Extended release workflow to emit SHA256SUMS, generate CycloneDX SBOM and provenance statement artifacts, produce cosign keyless signature/certificate files, and publish all artifacts to GitHub release with id-token permissions","compaction_level":0,"original_size":0,"labels":["release","security","supply-chain"],"dependencies":[{"issue_id":"bd-poy","depends_on_id":"bd-w5b","type":"blocks","created_at":"2026-02-25T04:04:32.093359Z","created_by":"zac"}]}
{"id":"bd-q7t","title":"PRM-FP-0101d: PDF document (document/pdf.rs)","description":"Fill in document/pdf.rs: PdfDocument with lopdf — page count, metadata access, basic structural queries. FILE: src/document/pdf.rs (1 file). VERIFY: cargo test --lib -- document::pdf","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:46:01.884626Z","created_by":"zac","updated_at":"2026-02-27T01:28:00.811188Z","closed_at":"2026-02-27T01:28:00.811086Z","close_reason":"Implemented PdfDocument page_count and metadata access with document::pdf tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-q7t","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:29.015391Z","created_by":"zac"}]}
{"id":"bd-sgp","title":"PRM-FP-0222: Install scripts (install.sh + install.ps1)","description":"Create scripts/install.sh and scripts/install.ps1 for fingerprint. Template from rvl's install scripts (5.7KB shell, 4.8KB PowerShell). Update binary name, GitHub repo, archive naming. README already references these but they don't exist yet.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-27T03:45:19.315401Z","created_by":"zac","updated_at":"2026-02-27T03:52:27.561790Z","closed_at":"2026-02-27T03:52:27.561509Z","close_reason":"Added scripts/install.sh and scripts/install.ps1 from cmdrvl installer template, retargeted to fingerprint repo/binary/archive naming and env vars (FINGERPRINT_*), with shell and PowerShell syntax checks","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-sgp","depends_on_id":"bd-12m","type":"blocks","created_at":"2026-02-27T03:46:11.714938Z","created_by":"zac"}]}
{"id":"bd-tdc","title":"PRM-FP-0109: Orchestration (lib.rs wiring)","description":"Wire pub fn run() → u8 in lib.rs: CLI dispatch → registry build → pipeline execution → witness append → exit code. Connect all modules into the final binary.\n\n## Files touched\nsrc/lib.rs (full implementation replacing stub)\n\n## Acceptance Criteria\n- pub fn run() → u8 handles full execution flow from PLAN.md section 'Execution flow (run mode)' steps 1-12\n- CLI dispatch: --version (clap), --describe, --schema, --list, witness subcommands, compile subcommand, run mode\n- Registry build with E_UNKNOWN_FP / E_DUPLICATE_FP_ID / E_UNTRUSTED_FP handling\n- Pipeline execution with correct exit code routing (0=ALL_MATCHED, 1=PARTIAL, 2=REFUSAL)\n- Witness append after pipeline (unless --no-witness)\n- Compile subcommand dispatch\n- E2E test: echo hashed JSONL | fingerprint --fp csv.v0 produces enriched output\n- E2E test: fingerprint --list shows built-in fingerprints\n- E2E test: invalid input → exit 2 with refusal envelope\n\n## Depends on\nPRM-FP-0100 (scaffold+CLI), PRM-FP-0105 (witness), PRM-FP-0107 (pipeline), PRM-FP-0108 (compile)","status":"closed","priority":1,"issue_type":"feature","assignee":"zac","created_at":"2026-02-26T11:20:38.395272Z","created_by":"zac","updated_at":"2026-02-27T01:48:07.702495Z","closed_at":"2026-02-27T01:48:07.702288Z","close_reason":"done","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-tdc","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:20:57.822644Z","created_by":"zac"},{"issue_id":"bd-tdc","depends_on_id":"bd-22r","type":"blocks","created_at":"2026-02-26T11:20:57.968488Z","created_by":"zac"},{"issue_id":"bd-tdc","depends_on_id":"bd-25m","type":"blocks","created_at":"2026-02-26T11:48:39.764684Z","created_by":"zac"},{"issue_id":"bd-tdc","depends_on_id":"bd-2c7","type":"blocks","created_at":"2026-02-26T11:48:39.600282Z","created_by":"zac"},{"issue_id":"bd-tdc","depends_on_id":"bd-374","type":"blocks","created_at":"2026-02-26T11:48:39.655797Z","created_by":"zac"},{"issue_id":"bd-tdc","depends_on_id":"bd-3cv","type":"blocks","created_at":"2026-02-26T11:48:39.710041Z","created_by":"zac"},{"issue_id":"bd-tdc","depends_on_id":"bd-hwe","type":"blocks","created_at":"2026-02-26T11:20:57.917210Z","created_by":"zac"},{"issue_id":"bd-tdc","depends_on_id":"bd-w2c","type":"blocks","created_at":"2026-02-26T11:48:39.819590Z","created_by":"zac"}]}
{"id":"bd-vfh","title":"PRM-FP-0208: PDF structural assertions (page_count, metadata_regex)","description":"Implement PDF-specific structural assertions that read from the PDF file directly (not text_path).\n\n## Assertion types\n1. page_count: PDF has pages within range → matched: bool\n   - Parameters: min (optional), max (optional)\n   - Uses lopdf to count pages\n2. metadata_regex: PDF metadata field matches regex → matched: bool\n   - Parameters: key (metadata field name), pattern (regex)\n   - Common keys: Creator, Producer, Title, Author\n   - Uses lopdf to read PDF info dict\n\n## Key distinction\nThese assertions read from `path` (the PDF), NOT from `text_path`. They work even when text_path is absent. This is the foundation for structural-only parent fingerprints.\n\n## Spec references\n- PLAN.md: Content assertions table (page_count, metadata_regex rows)\n- PLAN.md: Assertion dispatch by format table (pdf structural column)\n- PLAN.md: CBRE example (page_range and cbre_creator assertions)\n\n## Acceptance\n- page_count reads PDF page count via lopdf\n- metadata_regex reads PDF metadata via lopdf info dict\n- Both work without text_path present\n- Both work with format:pdf only (error on other formats)\n- Unit tests with sample PDF fixtures","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T23:46:10.755234Z","created_by":"zac","updated_at":"2026-02-27T01:18:36.170049Z","closed_at":"2026-02-27T01:18:36.169937Z","close_reason":"Implemented page_count and metadata_regex against PDF path via lopdf, enforced pdf-only behavior, and added PDF fixture-based unit tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-vfh","depends_on_id":"bd-f4n","type":"blocks","created_at":"2026-02-27T00:22:17.318507Z","created_by":"zac"}]}
{"id":"bd-w2c","title":"PRM-FP-0105b: Witness ledger + query","description":"Fill in witness/ledger.rs (append to EPISTEMIC_WITNESS or ~/.epistemic/witness.jsonl, --no-witness suppression, non-fatal failures) and witness/query.rs (witness query/last/count subcommands with filters). FILES: src/witness/ledger.rs, src/witness/query.rs (2 files). VERIFY: cargo test --lib -- witness::ledger && cargo test --lib -- witness::query","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:47:32.096634Z","created_by":"zac","updated_at":"2026-02-27T01:05:57.059384Z","closed_at":"2026-02-27T01:05:57.059232Z","close_reason":"Implemented witness ledger append/path and query/last/count with witness module tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-w2c","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:29.229538Z","created_by":"zac"},{"issue_id":"bd-w2c","depends_on_id":"bd-1pi","type":"blocks","created_at":"2026-02-26T11:48:39.434373Z","created_by":"zac"}]}
{"id":"bd-w5b","title":"PRM-FP-0003: Add base release workflow (build + publish artifacts)","description":"Implement base release workflow parity with rvl: build target matrix archives and publish GitHub release assets. Keep this issue focused on build/publish mechanics only.\n\n## Acceptance Criteria\n- Add .github/workflows/release.yml; workflow derives version from Cargo.toml and ensures tag exists; builds release archives for target matrix and uploads them to GitHub release; generated artifacts are downloadable from release page; no signing/SBOM/provenance steps in this bead (handled separately).\n\n## Notes\nNon-goal: cosign, SHA256SUMS signing, SBOM/provenance generation, or Homebrew formula update.","acceptance_criteria":"Add .github/workflows/release.yml; workflow derives version from Cargo.toml and ensures tag exists; builds release archives for target matrix and uploads them to GitHub release; generated artifacts are downloadable from release page; no signing/SBOM/provenance steps in this bead (handled separately).","notes":"Non-goal: cosign, SHA256SUMS signing, SBOM/provenance generation, or Homebrew formula update.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-25T03:58:30.864567Z","created_by":"zac","updated_at":"2026-02-27T03:18:25.302280Z","closed_at":"2026-02-27T03:18:25.302184Z","close_reason":"Added .github/workflows/release.yml with Cargo.toml version derivation, tag existence/match checks, release target matrix build archives, artifact upload, and GitHub release publish step; YAML validated","compaction_level":0,"original_size":0,"labels":["infra","release","workflow"],"dependencies":[{"issue_id":"bd-w5b","depends_on_id":"bd-tdc","type":"blocks","created_at":"2026-02-26T11:21:23.452677Z","created_by":"zac"}]}
{"id":"bd-zg8","title":"PRM-FP-0104c: Progress reporter (progress/reporter.rs)","description":"Fill in progress/reporter.rs: emit structured progress JSONL to stderr when --progress is set. Warning emission for skipped files. FILE: src/progress/reporter.rs (1 file). VERIFY: cargo test --lib -- progress::reporter","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-26T11:47:21.744035Z","created_by":"zac","updated_at":"2026-02-27T00:54:26.968422Z","closed_at":"2026-02-27T00:54:26.968181Z","close_reason":"Implemented structured progress/warning stderr JSONL reporter with progress::reporter tests","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-zg8","depends_on_id":"bd-1bm","type":"blocks","created_at":"2026-02-26T11:48:29.176622Z","created_by":"zac"}]}
{"id":"bd-3xa","title":"PRM-FP-0228: sheet_name_regex bind — capture matched sheet name for downstream assertions","description":"## Problem\n\nSpreadsheet assertions (`cell_regex`, `cell_eq`, `range_non_null`, `sheet_min_rows`) require a hardcoded `sheet` parameter. When a workbook contains sheets with varying names across producers (e.g., CMBS watchlist sheets named `Watchlist` vs `Servicer Watch List` vs `Watch List Report for {DEAL}`), `sheet_name_regex` can prove a matching sheet exists but downstream assertions cannot reference the matched name.\n\n## Proposal\n\nAdd an optional `bind` field to `sheet_name_regex`. When present, the matched sheet name is captured as a named variable (e.g., `$watl_sheet`) that downstream assertions can reference in their `sheet` parameter.\n\n```yaml\nassertions:\n  - sheet_name_regex:\n      pattern: \"(?i)watch\\\\s?list|WATL\"\n      bind: \"$watl_sheet\"\n\n  - cell_regex:\n      sheet: \"$watl_sheet\"\n      cell: A2\n      pattern: \"(?i)CREFC\"\n\n  - sheet_min_rows:\n      sheet: \"$watl_sheet\"\n      min_rows: 5\n```\n\n## Implementation\n\n1. Add `bind: Option<String>` to `SheetNameRegex` assertion variant\n2. Add a `bindings: HashMap<String, String>` to assertion evaluation context\n3. When `sheet_name_regex` passes with `bind`, store `{bind_name → matched_sheet_name}`\n4. Before evaluating any assertion with a `sheet` param starting with `$`, resolve from bindings\n5. If a `$`-prefixed sheet name has no binding, fail with descriptive error\n\n## Acceptance\n\n- `bind` field parses in YAML and compiles to Rust crate\n- Bound name resolves correctly in downstream `cell_eq`, `cell_regex`, `range_non_null`, `sheet_min_rows` assertions\n- Unresolved `$` references produce clear error messages\n- When multiple sheets match, the first match is used (consistent with assertion short-circuit semantics)\n- Unit tests in `assertions.rs` covering: basic bind+resolve, unresolved reference, multiple sheets matching\n\n## Test Case\n\nSee `tests/fixtures/cmbs-watl/` — CMBS Watchlist files where sheet name varies by servicer. The `cmbs-watl-desired.fp.yaml` shows the target definition using `bind`.","status":"pending","priority":1,"issue_type":"feature","created_at":"2026-02-27T09:35:00.000000Z","created_by":"zac","updated_at":"2026-02-27T09:35:00.000000Z","labels":["dsl","enhancement","cmbs-watl"],"compaction_level":0,"original_size":0}
{"id":"bd-3xb","title":"PRM-FP-0229: column_search assertion — search a column range for a regex match","description":"## Problem\n\nCMBS Excel workbooks have boilerplate text (CREFC headers, report titles, servicer names) in varying row positions. The current DSL requires `cell_regex` with a fixed cell reference, but the target row varies by servicer and format. The Lambda parser handles this by scanning the first ~30 rows; the fingerprint DSL has no equivalent.\n\n## Proposal\n\nAdd a `column_search` assertion that searches a single column over a row range for any cell matching a regex pattern.\n\n```yaml\nassertions:\n  - column_search:\n      sheet: \"Watchlist\"       # or \"$bound_name\"\n      column: A\n      row_range: \"1:20\"\n      pattern: \"(?i)CREFC Investor Reporting|SERVICER WATCHLIST\"\n```\n\nSemantics: scan cells A1 through A20; pass if ANY cell matches the pattern. This is the column-axis analog of `text_contains` for markdown.\n\n## Implementation\n\n1. Add `ColumnSearch { sheet, column, row_range, pattern }` to `Assertion` enum\n2. Parse `row_range` as `start:end` (1-based, inclusive)\n3. Iterate cells `{column}{start}` through `{column}{end}`, apply regex\n4. Pass on first match; fail if no cell matches\n5. In diagnose mode, report nearest partial matches and actual cell values scanned\n\n## Acceptance\n\n- Parses in YAML, compiles to crate\n- Scans specified column/row range and matches regex\n- Works with `$`-bound sheet names (from bd-3xa)\n- Diagnose mode shows what was scanned on failure\n- Unit tests: match found, no match, empty cells, out-of-range rows\n\n## Test Case\n\nSee `tests/fixtures/cmbs-watl/` — CREFC boilerplate appears at row 2 (BCMS RSRV), row 3 (MSC RSRV), or row 1 (CGCMT supp). `column_search` on A1:A10 catches all variants.","status":"pending","priority":1,"issue_type":"feature","created_at":"2026-02-27T09:35:00.000000Z","created_by":"zac","updated_at":"2026-02-27T09:35:00.000000Z","labels":["dsl","enhancement","cmbs-watl"],"compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3xb","depends_on_id":"bd-3xa","type":"depends_on","created_at":"2026-02-27T09:35:00.000000Z","created_by":"zac"}]}
{"id":"bd-3xc","title":"PRM-FP-0230: header_row_match assertion — detect header row by column pattern matching","description":"## Problem\n\nThe Lambda OSDA parser uses a NAME strategy that scans the first ~30 rows of a CSV/sheet looking for a row where enough column headers match known `name_variations` regex patterns (30-50% threshold). This is the core detection mechanism for WATL, DLSR, and all NAME-strategy schemas. The fingerprint DSL has no equivalent — `cell_regex` checks a single fixed cell.\n\n## Proposal\n\nAdd a `header_row_match` assertion that scans rows in a range and passes if any single row has at least `min_match` cells matching the provided column patterns.\n\n```yaml\nassertions:\n  - header_row_match:\n      sheet: \"$watl_sheet\"\n      row_range: \"1:30\"\n      min_match: 5\n      columns:\n        - pattern: \"(?i)Trans(action)?\\\\s*ID|^L1|^1(\\\\.0)?$\"\n        - pattern: \"(?i)Group\\\\s*ID|^L2|^2(\\\\.0)?$\"\n        - pattern: \"(?i)^Loan\\\\s*ID|^L3|^3(\\\\.0)?$\"\n        - pattern: \"(?i)Prospectus\\\\s*Loan\\\\s*ID|^L4|^4(\\\\.0)?$\"\n        - pattern: \"(?i)Property\\\\s*Name|^S55$|^5(\\\\.0)?$\"\n        - pattern: \"(?i)Property\\\\s*Type|^S61$|^6(\\\\.0)?$\"\n        - pattern: \"(?i)Comments.*Watchlist|^19(\\\\.0)?$\"\n```\n\nSemantics: for each row in `row_range`, test each cell against each column pattern. A cell matches at most one pattern (first match wins, no double-counting). If any row achieves `>= min_match` distinct pattern matches, the assertion passes.\n\n## Implementation\n\n1. Add `HeaderRowMatch { sheet, row_range, min_match, columns: Vec<ColumnPattern> }` to `Assertion` enum\n2. `ColumnPattern` has `pattern: String` (compiled to regex)\n3. For each row: iterate cells, match against patterns, count distinct matches\n4. Pass on first row achieving `min_match`; fail if no row qualifies\n5. In diagnose mode: report the best-matching row (highest count) and which patterns matched\n\n## Acceptance\n\n- Parses in YAML, compiles to crate\n- Correctly scans rows and counts distinct column pattern matches per row\n- Works with `$`-bound sheet names (from bd-3xa)\n- Diagnose mode reports best candidate row and match count\n- `min_match` threshold is respected (partial match = fail)\n- Unit tests: exact threshold match, below threshold, multiple qualifying rows, empty sheet\n- Integration test using CMBS-WATL fixture definitions\n\n## Test Case\n\nSee `tests/fixtures/cmbs-watl/` — the `cmbs-watl-desired.fp.yaml` uses `header_row_match` with 7 column patterns and `min_match: 5`. This mirrors the Lambda's 30% threshold on 22 columns. Header row is at row 11 (BCMS RSRV), row 4 (CGCMT supp), or row 12 (MSC RSRV).","status":"pending","priority":1,"issue_type":"feature","created_at":"2026-02-27T09:35:00.000000Z","created_by":"zac","updated_at":"2026-02-27T09:35:00.000000Z","labels":["dsl","enhancement","cmbs-watl"],"compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3xc","depends_on_id":"bd-3xa","type":"depends_on","created_at":"2026-02-27T09:35:00.000000Z","created_by":"zac"},{"issue_id":"bd-3xc","depends_on_id":"bd-3xb","type":"depends_on","created_at":"2026-02-27T09:35:00.000000Z","created_by":"zac"}]}
